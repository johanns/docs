<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libepaper: API Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libepaper<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">A modern C++23 library for controlling Waveshare e-paper displays on Raspberry Pi</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">API Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md22"></a> A comprehensive guide to using the libepaper API for e-paper display control.</p>
<h1><a class="anchor" id="autotoc_md23"></a>
Table of Contents</h1>
<ul>
<li>Getting Started</li>
<li>Display Creation &amp; Management</li>
<li>Drawing Operations</li>
<li>Color &amp; Grayscale</li>
<li>Display Refresh &amp; Power Management</li>
<li>Error Handling</li>
<li>Advanced Topics</li>
<li>Best Practices</li>
<li>Common Patterns</li>
<li>Troubleshooting</li>
</ul>
<h1><a class="anchor" id="autotoc_md24"></a>
Getting Started</h1>
<h2><a class="anchor" id="autotoc_md25"></a>
Requirements</h2>
<ul>
<li>Raspberry Pi with SPI enabled</li>
<li>C++23 capable compiler (GCC 14+ or Clang 18+)</li>
<li>BCM2835 library installed</li>
<li>Root privileges for GPIO/SPI access</li>
</ul>
<h2><a class="anchor" id="autotoc_md26"></a>
Basic Setup</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d5/d08/device_8hpp.html">epaper/device.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d2/da4/display_8hpp.html">epaper/display.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d1/d76/epd27_8hpp.html">epaper/drivers/epd27.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/d50/font_8hpp.html">epaper/font.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../db/da4/namespaceepaper.html">epaper</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// 1. Initialize hardware device</span></div>
<div class="line">    <a class="code hl_class" href="../../d2/d80/classepaper_1_1Device.html">Device</a> device;</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> result = device.<a class="code hl_function" href="../../d2/d80/classepaper_1_1Device.html#ae0a60dbaca6d6c4e442982338748bcbb">init</a>(); !result) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Device init failed: &quot;</span> &lt;&lt; result.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 2. Create display (auto-sleep enabled by default)</span></div>
<div class="line">    <span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(</div>
<div class="line">        device,</div>
<div class="line">        DisplayMode::BlackWhite,    <span class="comment">// or DisplayMode::Grayscale4</span></div>
<div class="line">        Orientation::Portrait0,      <span class="comment">// or Landscape90, Portrait180, Landscape270</span></div>
<div class="line">        <span class="keyword">true</span>                         <span class="comment">// auto-sleep enabled (recommended)</span></div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!display) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Display creation failed: &quot;</span> &lt;&lt; display.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 3. Draw something</span></div>
<div class="line">    display-&gt;clear(Color::White);</div>
<div class="line">    display-&gt;draw_string(10, 10, <span class="stringliteral">&quot;Hello World!&quot;</span>, Font::font16(),</div>
<div class="line">                        Color::Black, Color::White);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 4. Refresh display (will auto-sleep after)</span></div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> result = display-&gt;refresh(); !result) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Refresh failed: &quot;</span> &lt;&lt; result.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassepaper_1_1Device_html"><div class="ttname"><a href="../../d2/d80/classepaper_1_1Device.html">epaper::Device</a></div><div class="ttdoc">RAII wrapper for BCM2835 device.</div><div class="ttdef"><b>Definition</b> device.hpp:44</div></div>
<div class="ttc" id="aclassepaper_1_1Device_html_ae0a60dbaca6d6c4e442982338748bcbb"><div class="ttname"><a href="../../d2/d80/classepaper_1_1Device.html#ae0a60dbaca6d6c4e442982338748bcbb">epaper::Device::init</a></div><div class="ttdeci">auto init() -&gt; std::expected&lt; void, Error &gt;</div><div class="ttdoc">Initialize the BCM2835 library and SPI.</div><div class="ttdef"><b>Definition</b> device.cpp:40</div></div>
<div class="ttc" id="adevice_8hpp_html"><div class="ttname"><a href="../../d5/d08/device_8hpp.html">device.hpp</a></div></div>
<div class="ttc" id="adisplay_8hpp_html"><div class="ttname"><a href="../../d2/da4/display_8hpp.html">display.hpp</a></div></div>
<div class="ttc" id="aepd27_8hpp_html"><div class="ttname"><a href="../../d1/d76/epd27_8hpp.html">epd27.hpp</a></div></div>
<div class="ttc" id="afont_8hpp_html"><div class="ttname"><a href="../../df/d50/font_8hpp.html">font.hpp</a></div></div>
<div class="ttc" id="anamespaceepaper_html"><div class="ttname"><a href="../../db/da4/namespaceepaper.html">epaper</a></div><div class="ttdef"><b>Definition</b> color.hpp:5</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27"></a>
Your First Program</h2>
<p>Here's a complete minimal example that draws a rectangle with text:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d5/d08/device_8hpp.html">epaper/device.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d2/da4/display_8hpp.html">epaper/display.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d1/d76/epd27_8hpp.html">epaper/drivers/epd27.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/d50/font_8hpp.html">epaper/font.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../db/da4/namespaceepaper.html">epaper</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Initialize device</span></div>
<div class="line">    <a class="code hl_class" href="../../d2/d80/classepaper_1_1Device.html">Device</a> device;</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> result = device.<a class="code hl_function" href="../../d2/d80/classepaper_1_1Device.html#ae0a60dbaca6d6c4e442982338748bcbb">init</a>(); !result) {</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create display in landscape orientation</span></div>
<div class="line">    <span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(</div>
<div class="line">        device,</div>
<div class="line">        DisplayMode::BlackWhite,</div>
<div class="line">        Orientation::Landscape90</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!display) {</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Clear screen to white</span></div>
<div class="line">    display-&gt;clear(Color::White);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Draw a border rectangle</span></div>
<div class="line">    display-&gt;draw_rectangle(0, 0,</div>
<div class="line">        display-&gt;effective_width() - 1,</div>
<div class="line">        display-&gt;effective_height() - 1,</div>
<div class="line">        Color::Black,</div>
<div class="line">        DrawFill::Empty);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Draw title</span></div>
<div class="line">    display-&gt;draw_string(10, 10, <span class="stringliteral">&quot;My First E-Paper App&quot;</span>,</div>
<div class="line">        Font::font20(), Color::Black, Color::White);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Draw a filled rectangle</span></div>
<div class="line">    display-&gt;draw_rectangle(10, 40, 100, 80,</div>
<div class="line">        Color::Black, DrawFill::Full);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Draw text on black background</span></div>
<div class="line">    display-&gt;draw_string(15, 50, <span class="stringliteral">&quot;libepaper&quot;</span>,</div>
<div class="line">        Font::font12(), Color::White, Color::Black);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Refresh display</span></div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> result = display-&gt;refresh(); !result) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Refresh failed\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Display updated successfully!\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Compile and run:</b> </p><div class="fragment"><div class="line"># Build</div>
<div class="line">cmake --build build</div>
<div class="line"> </div>
<div class="line"># Run (requires sudo for GPIO/SPI)</div>
<div class="line">sudo ./build/your_program</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md28"></a>
Display Creation &amp; Management</h1>
<h2><a class="anchor" id="autotoc_md29"></a>
Creating a Display</h2>
<p>Use the factory function <code>create_display&lt;Driver&gt;()</code> to create displays:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d2/da4/display_8hpp.html">epaper/display.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d1/d76/epd27_8hpp.html">epaper/drivers/epd27.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(</div>
<div class="line">    device,                      <span class="comment">// Hardware device</span></div>
<div class="line">    DisplayMode::BlackWhite,     <span class="comment">// Display mode</span></div>
<div class="line">    Orientation::Landscape90,    <span class="comment">// Orientation</span></div>
<div class="line">    <span class="keyword">true</span>                         <span class="comment">// Auto-sleep enabled</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Returns std::expected&lt;std::unique_ptr&lt;Display&gt;, Error&gt;</span></div>
<div class="line"><span class="keywordflow">if</span> (!display) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed: &quot;</span> &lt;&lt; display.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use with -&gt; operator</span></div>
<div class="line">display-&gt;draw_point(10, 10, Color::Black);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md30"></a>
Display Modes</h2>
<p>The library supports two display modes:</p>
<h3><a class="anchor" id="autotoc_md31"></a>
BlackWhite Mode (1 bit per pixel)</h3>
<p>Pure binary output - only black and white pixels.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(</div>
<div class="line">    device,</div>
<div class="line">    DisplayMode::BlackWhite,</div>
<div class="line">    Orientation::Portrait0</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Only these colors work in BlackWhite mode:</span></div>
<div class="line">display-&gt;draw_point(10, 10, Color::White);  <span class="comment">// White pixel</span></div>
<div class="line">display-&gt;draw_point(20, 20, Color::Black);  <span class="comment">// Black pixel</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Gray colors will be converted to black</span></div>
<div class="line">display-&gt;draw_point(30, 30, Color::Gray1);  <span class="comment">// → Black</span></div>
<div class="line">display-&gt;draw_point(40, 40, Color::Gray2);  <span class="comment">// → Black</span></div>
</div><!-- fragment --><p><b>When to use:</b></p><ul>
<li>Highest contrast output</li>
<li>Text-heavy displays</li>
<li>Smaller memory footprint (5,808 bytes for 2.7")
- Faster SPI transfers

@subsubsection autotoc_md32 Grayscale4 Mode (2 bits per pixel)

Four-level grayscale output.

@icode{cpp} 
auto display = create_display&lt;EPD27&gt;(
    device,
    DisplayMode::Grayscale4,
    Orientation::Portrait0
);

// All four gray levels available:
display-&gt;draw_point(10, 10, Color::White);  // Lightest
display-&gt;draw_point(20, 20, Color::Gray1);  // Light gray
display-&gt;draw_point(30, 30, Color::Gray2);  // Dark gray
display-&gt;draw_point(40, 40, Color::Black);  // Darkest
@endicode 

&lt;strong&gt;When to use:&lt;/strong&gt;
- Images and photographs
- Charts with multiple data series
- Anti-aliased graphics
- More nuanced visual output

&lt;strong&gt;Trade-offs:&lt;/strong&gt;
- Double memory usage (11,616 bytes for 2.7")</li>
<li>Slightly slower SPI transfer</li>
<li>Better visual quality</li>
</ul>
<h2><a class="anchor" id="autotoc_md33"></a>
Orientation</h2>
<p>The library supports four orientations with automatic coordinate transformation:</p>
<div class="fragment"><div class="line"><span class="comment">// Portrait (default) - 176x264 pixels</span></div>
<div class="line"><span class="keyword">auto</span> display1 = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Portrait0);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Landscape (90° clockwise) - 264x176 pixels</span></div>
<div class="line"><span class="keyword">auto</span> display2 = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Landscape90);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Upside-down portrait (180°) - 176x264 pixels</span></div>
<div class="line"><span class="keyword">auto</span> display3 = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Portrait180);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Landscape counter-clockwise (270°) - 264x176 pixels</span></div>
<div class="line"><span class="keyword">auto</span> display4 = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Landscape270);</div>
</div><!-- fragment --><p><b>Coordinate Transformation:</b></p>
<p>The coordinate system is automatically transformed. Point (0, 0) is always the top-left corner in the <em>rotated</em> coordinate space.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Landscape90);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get effective dimensions (accounts for rotation)</span></div>
<div class="line"><span class="keyword">auto</span> width = display-&gt;effective_width();    <span class="comment">// 264 (rotated!)</span></div>
<div class="line"><span class="keyword">auto</span> height = display-&gt;effective_height();  <span class="comment">// 176 (rotated!)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw at &quot;top-left&quot; in rotated space</span></div>
<div class="line">display-&gt;draw_point(0, 0, Color::Black);  <span class="comment">// Appears at actual top-left</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// All drawing operations use rotated coordinates</span></div>
<div class="line">display-&gt;draw_rectangle(0, 0, width - 1, height - 1, Color::Black, DrawFill::Empty);</div>
</div><!-- fragment --><p><b>Orientation Summary:</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Orientation   </th><th class="markdownTableHeadNone">Rotation   </th><th class="markdownTableHeadNone">Width×Height   </th><th class="markdownTableHeadNone">Top-Left (0,0) Maps To    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Portrait0   </td><td class="markdownTableBodyNone">0°   </td><td class="markdownTableBodyNone">176×264   </td><td class="markdownTableBodyNone">Physical top-left    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Landscape90   </td><td class="markdownTableBodyNone">90° CW   </td><td class="markdownTableBodyNone">264×176   </td><td class="markdownTableBodyNone">Physical top-right    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Portrait180   </td><td class="markdownTableBodyNone">180°   </td><td class="markdownTableBodyNone">176×264   </td><td class="markdownTableBodyNone">Physical bottom-right    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Landscape270   </td><td class="markdownTableBodyNone">270° CW   </td><td class="markdownTableBodyNone">264×176   </td><td class="markdownTableBodyNone">Physical bottom-left   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md34"></a>
Drawing Operations</h1>
<p>All drawing operations are <b>noexcept</b> and never fail. Out-of-bounds coordinates are silently clipped.</p>
<h2><a class="anchor" id="autotoc_md35"></a>
Points</h2>
<div class="fragment"><div class="line"><span class="comment">// Draw a single pixel</span></div>
<div class="line">display-&gt;draw_point(x, y, Color::Black);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a larger point (2x2, 3x3, 4x4, 5x5 pixels)</span></div>
<div class="line">display-&gt;draw_point(x, y, Color::Black, DotPixel::Pixel2x2);</div>
<div class="line">display-&gt;draw_point(x, y, Color::Black, DotPixel::Pixel3x3);</div>
<div class="line">display-&gt;draw_point(x, y, Color::Black, DotPixel::Pixel4x4);</div>
<div class="line">display-&gt;draw_point(x, y, Color::Black, DotPixel::Pixel5x5);</div>
</div><!-- fragment --><p><b>DotPixel enum:</b></p><ul>
<li><code>Pixel1x1</code>: Single pixel (default)</li>
<li><code>Pixel2x2</code>: 2×2 pixel block</li>
<li><code>Pixel3x3</code>: 3×3 pixel block</li>
<li><code>Pixel4x4</code>: 4×4 pixel block</li>
<li><code>Pixel5x5</code>: 5×5 pixel block</li>
</ul>
<h2><a class="anchor" id="autotoc_md36"></a>
Lines</h2>
<div class="fragment"><div class="line"><span class="comment">// Draw a line from (x1, y1) to (x2, y2)</span></div>
<div class="line">display-&gt;draw_line(x1, y1, x2, y2, Color::Black);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thicker lines</span></div>
<div class="line">display-&gt;draw_line(x1, y1, x2, y2, Color::Black, DotPixel::Pixel2x2);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Dotted or dashed lines</span></div>
<div class="line">display-&gt;draw_line(x1, y1, x2, y2, Color::Black,</div>
<div class="line">                  DotPixel::Pixel1x1, LineStyle::Dotted);</div>
<div class="line"> </div>
<div class="line">display-&gt;draw_line(x1, y1, x2, y2, Color::Black,</div>
<div class="line">                  DotPixel::Pixel1x1, LineStyle::Dashed);</div>
</div><!-- fragment --><p><b>LineStyle enum:</b></p><ul>
<li><code>Solid</code>: Continuous line (default)</li>
<li><code>Dotted</code>: Dot every 4 pixels</li>
<li><code>Dashed</code>: Dash pattern (8 on, 4 off)</li>
</ul>
<p><b>Examples:</b> </p><div class="fragment"><div class="line"><span class="comment">// Draw a grid</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> x = 0; x &lt; display-&gt;effective_width(); x += 20) {</div>
<div class="line">    display-&gt;draw_line(x, 0, x, display-&gt;effective_height() - 1, Color::Black);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> y = 0; y &lt; display-&gt;effective_height(); y += 20) {</div>
<div class="line">    display-&gt;draw_line(0, y, display-&gt;effective_width() - 1, y, Color::Black);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37"></a>
Rectangles</h2>
<div class="fragment"><div class="line"><span class="comment">// Draw a rectangle outline</span></div>
<div class="line">display-&gt;draw_rectangle(x, y, width, height, Color::Black, DrawFill::Empty);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a filled rectangle</span></div>
<div class="line">display-&gt;draw_rectangle(x, y, width, height, Color::Black, DrawFill::Full);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thicker borders</span></div>
<div class="line">display-&gt;draw_rectangle(x, y, width, height, Color::Black,</div>
<div class="line">                       DrawFill::Empty, DotPixel::Pixel2x2);</div>
</div><!-- fragment --><p><b>Parameters:</b></p><ul>
<li><code>x, y</code>: Top-left corner</li>
<li><code>width, height</code>: Rectangle dimensions</li>
<li><code>color</code>: Color to draw</li>
<li><code>fill</code>: <code>DrawFill::Empty</code> (outline) or <code>DrawFill::Full</code> (filled)</li>
<li><code>pixel</code>: Line thickness (default: <code>Pixel1x1</code>)</li>
</ul>
<p><b>Examples:</b> </p><div class="fragment"><div class="line"><span class="comment">// Draw a button</span></div>
<div class="line">display-&gt;draw_rectangle(10, 10, 100, 40, Color::Black, DrawFill::Empty);</div>
<div class="line">display-&gt;draw_string(30, 20, <span class="stringliteral">&quot;OK&quot;</span>, Font::font16(), Color::Black, Color::White);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a filled header bar</span></div>
<div class="line">display-&gt;draw_rectangle(0, 0, display-&gt;effective_width(), 30,</div>
<div class="line">                       Color::Black, DrawFill::Full);</div>
<div class="line">display-&gt;draw_string(10, 8, <span class="stringliteral">&quot;Dashboard&quot;</span>, Font::font16(),</div>
<div class="line">                    Color::White, Color::Black);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md38"></a>
Circles</h2>
<div class="fragment"><div class="line"><span class="comment">// Draw a circle outline</span></div>
<div class="line">display-&gt;draw_circle(center_x, center_y, radius, Color::Black, DrawFill::Empty);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a filled circle</span></div>
<div class="line">display-&gt;draw_circle(center_x, center_y, radius, Color::Black, DrawFill::Full);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thicker outline</span></div>
<div class="line">display-&gt;draw_circle(center_x, center_y, radius, Color::Black,</div>
<div class="line">                    DrawFill::Empty, DotPixel::Pixel2x2);</div>
</div><!-- fragment --><p><b>Examples:</b> </p><div class="fragment"><div class="line"><span class="comment">// Draw a bullseye</span></div>
<div class="line">display-&gt;draw_circle(88, 132, 50, Color::Black, DrawFill::Empty);</div>
<div class="line">display-&gt;draw_circle(88, 132, 40, Color::Black, DrawFill::Empty);</div>
<div class="line">display-&gt;draw_circle(88, 132, 30, Color::Black, DrawFill::Empty);</div>
<div class="line">display-&gt;draw_circle(88, 132, 10, Color::Black, DrawFill::Full);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a status indicator (filled dot)</span></div>
<div class="line"><span class="keywordflow">if</span> (connected) {</div>
<div class="line">    display-&gt;draw_circle(250, 10, 5, Color::Black, DrawFill::Full);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md39"></a>
Text &amp; Fonts</h2>
<div class="fragment"><div class="line"><span class="comment">// Draw text</span></div>
<div class="line">display-&gt;draw_string(x, y, <span class="stringliteral">&quot;Hello World!&quot;</span>, Font::font16(),</div>
<div class="line">                    Color::Black, Color::White);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Different font sizes</span></div>
<div class="line">display-&gt;draw_string(10, 10, <span class="stringliteral">&quot;Tiny&quot;</span>, Font::font8(),</div>
<div class="line">                    Color::Black, Color::White);</div>
<div class="line">display-&gt;draw_string(10, 30, <span class="stringliteral">&quot;Small&quot;</span>, Font::font12(),</div>
<div class="line">                    Color::Black, Color::White);</div>
<div class="line">display-&gt;draw_string(10, 50, <span class="stringliteral">&quot;Medium&quot;</span>, Font::font16(),</div>
<div class="line">                    Color::Black, Color::White);</div>
<div class="line">display-&gt;draw_string(10, 80, <span class="stringliteral">&quot;Large&quot;</span>, Font::font20(),</div>
<div class="line">                    Color::Black, Color::White);</div>
<div class="line">display-&gt;draw_string(10, 110, <span class="stringliteral">&quot;XLarge&quot;</span>, Font::font24(),</div>
<div class="line">                    Color::Black, Color::White);</div>
</div><!-- fragment --><p><b>Available Fonts:</b></p><ul>
<li><code>Font::font8()</code>: 5×8 pixels per character</li>
<li><code>Font::font12()</code>: 7×12 pixels per character</li>
<li><code>Font::font16()</code>: 11×16 pixels per character</li>
<li><code>Font::font20()</code>: 14×20 pixels per character</li>
<li><code>Font::font24()</code>: 17×24 pixels per character</li>
</ul>
<p><b>Foreground/Background Colors:</b> </p><div class="fragment"><div class="line"><span class="comment">// Black text on white background</span></div>
<div class="line">display-&gt;draw_string(10, 10, <span class="stringliteral">&quot;Normal&quot;</span>, Font::font16(),</div>
<div class="line">                    Color::Black, Color::White);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// White text on black background (inverse)</span></div>
<div class="line">display-&gt;draw_string(10, 30, <span class="stringliteral">&quot;Inverse&quot;</span>, Font::font16(),</div>
<div class="line">                    Color::White, Color::Black);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Gray text (in grayscale mode)</span></div>
<div class="line">display-&gt;draw_string(10, 50, <span class="stringliteral">&quot;Gray&quot;</span>, Font::font16(),</div>
<div class="line">                    Color::Gray2, Color::White);</div>
</div><!-- fragment --><p><b>Multi-line Text:</b> </p><div class="fragment"><div class="line"><span class="comment">// Manual line spacing</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> x = 10;</div>
<div class="line"><span class="keywordtype">size_t</span> y = 10;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> line_height = 20;</div>
<div class="line"> </div>
<div class="line">display-&gt;draw_string(x, y, <span class="stringliteral">&quot;Line 1&quot;</span>, Font::font16(), Color::Black, Color::White);</div>
<div class="line">y += line_height;</div>
<div class="line">display-&gt;draw_string(x, y, <span class="stringliteral">&quot;Line 2&quot;</span>, Font::font16(), Color::Black, Color::White);</div>
<div class="line">y += line_height;</div>
<div class="line">display-&gt;draw_string(x, y, <span class="stringliteral">&quot;Line 3&quot;</span>, Font::font16(), Color::Black, Color::White);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md40"></a>
Numbers</h2>
<div class="fragment"><div class="line"><span class="comment">// Draw an integer</span></div>
<div class="line"><span class="keywordtype">int</span> value = 42;</div>
<div class="line">display-&gt;draw_number(x, y, value, Font::font16(),</div>
<div class="line">                    Color::Black, Color::White);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a decimal with precision</span></div>
<div class="line"><span class="keywordtype">double</span> pi = 3.14159;</div>
<div class="line">display-&gt;draw_decimal(x, y, pi, 3, Font::font16(),  <span class="comment">// 3 decimal places</span></div>
<div class="line">                     Color::Black, Color::White);</div>
<div class="line"><span class="comment">// Displays: &quot;3.141&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Right-aligned numbers (for tables)</span></div>
<div class="line"><span class="keywordtype">int</span> price = 199;</div>
<div class="line">display-&gt;draw_number(200, y, price, Font::font12(),</div>
<div class="line">                    Color::Black, Color::White);</div>
</div><!-- fragment --><p><b>Formatting Examples:</b> </p><div class="fragment"><div class="line"><span class="comment">// Display sensor readings</span></div>
<div class="line">display-&gt;draw_string(10, 10, <span class="stringliteral">&quot;Temperature:&quot;</span>, Font::font12(),</div>
<div class="line">                    Color::Black, Color::White);</div>
<div class="line">display-&gt;draw_decimal(110, 10, temperature, 1, Font::font12(),</div>
<div class="line">                     Color::Black, Color::White);</div>
<div class="line">display-&gt;draw_string(150, 10, <span class="stringliteral">&quot;C&quot;</span>, Font::font12(),</div>
<div class="line">                    Color::Black, Color::White);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Display prices</span></div>
<div class="line">display-&gt;draw_string(10, 30, <span class="stringliteral">&quot;$&quot;</span>, Font::font16(),</div>
<div class="line">                    Color::Black, Color::White);</div>
<div class="line">display-&gt;draw_decimal(20, 30, price, 2, Font::font16(),</div>
<div class="line">                     Color::Black, Color::White);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md41"></a>
Bitmaps</h2>
<div class="fragment"><div class="line"><span class="comment">// Draw from raw pixel data</span></div>
<div class="line">std::vector&lt;Color&gt; pixels = {</div>
<div class="line">    Color::Black, Color::White, Color::Black, Color::White,</div>
<div class="line">    Color::White, Color::Black, Color::White, Color::Black,</div>
<div class="line">    Color::Black, Color::White, Color::Black, Color::White,</div>
<div class="line">    Color::White, Color::Black, Color::White, Color::Black</div>
<div class="line">};</div>
<div class="line">display-&gt;draw_bitmap(10, 10, pixels, 4, 4);  <span class="comment">// 4×4 checkerboard</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw from image file (PNG, JPEG, BMP, etc.)</span></div>
<div class="line"><span class="keyword">auto</span> result = display-&gt;draw_bitmap_from_file(10, 50, <span class="stringliteral">&quot;logo.png&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!result) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to load image: &quot;</span> &lt;&lt; result.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw with scaling</span></div>
<div class="line">display-&gt;draw_bitmap_from_file(10, 100, <span class="stringliteral">&quot;photo.jpg&quot;</span>, 200, 150);  <span class="comment">// Scale to 200×150</span></div>
</div><!-- fragment --><p><b>Supported Image Formats:</b></p><ul>
<li>PNG (including transparency)</li>
<li>JPEG</li>
<li>BMP</li>
<li>TGA</li>
<li>GIF (first frame only)</li>
<li>PSD (composited view)</li>
<li>HDR</li>
</ul>
<p><b>Automatic Color Conversion:</b></p>
<p>The library automatically converts color images to your display's mode:</p>
<ol type="1">
<li><b>RGB to Grayscale</b>: Uses standard perceptual formula (0.299×R + 0.587×G + 0.114×B)</li>
<li><b>Quantization</b>:<ul>
<li><b>BlackWhite mode</b>: 50% brightness threshold (gray ≥ 128 → White)</li>
<li><b>Grayscale4 mode</b>: 4-level mapping (0-63→Black, 64-127→Gray2, 128-191→Gray1, 192-255→White)</li>
</ul>
</li>
</ol>
<p>This means you can load <b>any color image</b> (photos, graphics, screenshots) and the library intelligently converts it to work with your e-paper display:</p>
<div class="fragment"><div class="line"><span class="comment">// Load a full-color photograph - automatically converted!</span></div>
<div class="line">display-&gt;draw_bitmap_from_file(10, 10, <span class="stringliteral">&quot;vacation_photo.jpg&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Load a colorful logo - automatically converted!</span></div>
<div class="line">display-&gt;draw_bitmap_from_file(100, 50, <span class="stringliteral">&quot;company_logo.png&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// No manual color processing needed!</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md42"></a>
Color &amp; Grayscale</h1>
<h2><a class="anchor" id="autotoc_md43"></a>
Color Enum</h2>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> <a class="code hl_enumeration" href="../../db/da4/namespaceepaper.html#abbcfe3e537fe42c69ae050cbfb36fcc3">Color</a> {</div>
<div class="line">    White,  <span class="comment">// Value: 0 (lightest)</span></div>
<div class="line">    Gray1,  <span class="comment">// Value: 1 (light gray, grayscale mode only)</span></div>
<div class="line">    Gray2,  <span class="comment">// Value: 2 (dark gray, grayscale mode only)</span></div>
<div class="line">    Black   <span class="comment">// Value: 3 (darkest)</span></div>
<div class="line">};</div>
<div class="ttc" id="anamespaceepaper_html_abbcfe3e537fe42c69ae050cbfb36fcc3"><div class="ttname"><a href="../../db/da4/namespaceepaper.html#abbcfe3e537fe42c69ae050cbfb36fcc3">epaper::Color</a></div><div class="ttdeci">Color</div><div class="ttdoc">Color representation for e-paper displays.</div><div class="ttdef"><b>Definition</b> display.hpp:23</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md44"></a>
Color Mapping by Display Mode</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Color   </th><th class="markdownTableHeadNone">BlackWhite Mode   </th><th class="markdownTableHeadNone">Grayscale4 Mode    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">White   </td><td class="markdownTableBodyNone">White (0)   </td><td class="markdownTableBodyNone">White (0)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Gray1   </td><td class="markdownTableBodyNone">Black (1)   </td><td class="markdownTableBodyNone">Light gray (1)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Gray2   </td><td class="markdownTableBodyNone">Black (1)   </td><td class="markdownTableBodyNone">Dark gray (2)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Black   </td><td class="markdownTableBodyNone">Black (1)   </td><td class="markdownTableBodyNone">Black (3)   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md45"></a>
Working with Grayscale</h2>
<div class="fragment"><div class="line"><span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(device, DisplayMode::Grayscale4,</div>
<div class="line">                                     Orientation::Portrait0);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a grayscale gradient</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> x = 0; x &lt; display-&gt;effective_width(); x++) {</div>
<div class="line">    <a class="code hl_enumeration" href="../../db/da4/namespaceepaper.html#abbcfe3e537fe42c69ae050cbfb36fcc3">Color</a> shade;</div>
<div class="line">    <span class="keywordflow">if</span> (x &lt; 44) shade = Color::White;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &lt; 88) shade = Color::Gray1;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &lt; 132) shade = Color::Gray2;</div>
<div class="line">    <span class="keywordflow">else</span> shade = Color::Black;</div>
<div class="line"> </div>
<div class="line">    display-&gt;draw_line(x, 0, x, display-&gt;effective_height() - 1, shade);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw anti-aliased graphics</span></div>
<div class="line"><span class="comment">// (manually, by using intermediate gray levels at edges)</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md46"></a>
Display Refresh &amp; Power Management</h1>
<h2><a class="anchor" id="autotoc_md47"></a>
Refresh Behavior</h2>
<p>Call <code>refresh()</code> to update the physical display with the framebuffer contents.</p>
<div class="fragment"><div class="line"><span class="comment">// Draw operations modify the framebuffer</span></div>
<div class="line">display-&gt;draw_string(10, 10, <span class="stringliteral">&quot;Hello&quot;</span>, Font::font16(), Color::Black, Color::White);</div>
<div class="line">display-&gt;draw_circle(88, 132, 30, Color::Black, DrawFill::Full);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Nothing appears on screen yet...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Refresh to display</span></div>
<div class="line"><span class="keyword">auto</span> result = display-&gt;refresh();</div>
<div class="line"><span class="keywordflow">if</span> (!result) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Refresh failed: &quot;</span> &lt;&lt; result.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Now the screen shows the updates!</span></div>
</div><!-- fragment --><p><b>Important:</b> <code>refresh()</code> is a <b>blocking operation</b> that takes ~2 seconds for the EPD27.</p>
<h2><a class="anchor" id="autotoc_md48"></a>
Auto-Sleep (IMPORTANT!)</h2>
<p><b>The library automatically manages sleep/wake cycles to prevent screen burn-in.</b></p>
<div class="fragment"><div class="line"><span class="comment">// Create display with auto-sleep enabled (default and recommended)</span></div>
<div class="line"><span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Portrait0, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// First render</span></div>
<div class="line">display-&gt;draw_string(10, 10, <span class="stringliteral">&quot;Frame 1&quot;</span>, Font::font16(), Color::Black, Color::White);</div>
<div class="line">display-&gt;refresh();  <span class="comment">// Display automatically enters sleep mode after refresh</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// ... minutes or hours later ...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Second render - transparent wake!</span></div>
<div class="line">display-&gt;draw_string(10, 10, <span class="stringliteral">&quot;Frame 2&quot;</span>, Font::font16(), Color::Black, Color::White);</div>
<div class="line">display-&gt;refresh();  <span class="comment">// Library auto-wakes if needed, then refreshes ✨</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// No manual wake() calls needed!</span></div>
</div><!-- fragment --><p><b>How It Works:</b></p><ol type="1">
<li>After <code>refresh()</code>, display automatically sleeps (if auto-sleep enabled)</li>
<li>Driver internally tracks sleep state with <code>is_asleep_</code> flag</li>
<li>Next <code>refresh()</code> automatically calls <code>wake()</code> if asleep</li>
<li><code>wake()</code> re-initializes the EPD27 hardware (~2 second delay)</li>
<li>Refresh proceeds normally</li>
</ol>
<p><b>Why Auto-Sleep?</b></p><ul>
<li><b>Prevents burn-in</b>: E-paper displays degrade if left in high voltage state</li>
<li><b>Follows manufacturer recommendation</b>: Waveshare recommends sleep between refreshes</li>
<li><b>Transparent</b>: Library handles everything automatically</li>
<li><b>Safe</b>: No risk of forgetting to sleep</li>
</ul>
<p><b>Benefits of Transparent Wake:</b></p><ul>
<li><b>Ergonomic</b>: No manual sleep/wake management</li>
<li><b>Correct</b>: Impossible to forget to wake</li>
<li><b>Simple</b>: Same code works for all scenarios</li>
</ul>
<h2><a class="anchor" id="autotoc_md49"></a>
Disabling Auto-Sleep</h2>
<p>For special use cases where you need manual control:</p>
<div class="fragment"><div class="line"><span class="comment">// Disable auto-sleep</span></div>
<div class="line"><span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Portrait0, <span class="keyword">false</span>);  <span class="comment">// false = disabled</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Now you must manually manage sleep</span></div>
<div class="line">display-&gt;refresh();  <span class="comment">// Does NOT auto-sleep</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Manual sleep (when you&#39;re done)</span></div>
<div class="line">display-&gt;sleep();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Manual wake before next refresh</span></div>
<div class="line">display-&gt;wake();  <span class="comment">// Required! EPD27 needs re-init (~2s)</span></div>
<div class="line">display-&gt;refresh();</div>
</div><!-- fragment --><p><b>When to disable auto-sleep:</b></p><ul>
<li>Rapid successive refreshes (e.g., animation, though not recommended for e-paper)</li>
<li>Custom power management logic</li>
<li>Benchmarking/testing</li>
</ul>
<p><b>Recommendation:</b> Keep auto-sleep <b>enabled</b> (default). It prevents hardware damage and the library handles wake automatically.</p>
<h2><a class="anchor" id="autotoc_md50"></a>
Manual Power Control</h2>
<p>The library also provides explicit power control methods:</p>
<div class="fragment"><div class="line"><span class="comment">// Put display to sleep (usually automatic with auto-sleep)</span></div>
<div class="line">display-&gt;sleep();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Wake from sleep (usually automatic on next refresh)</span></div>
<div class="line">display-&gt;wake();  <span class="comment">// EPD27: ~2 second re-initialization</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Complete power off (if supported by hardware)</span></div>
<div class="line"><span class="keywordflow">if</span> (display-&gt;supports_power_control()) {</div>
<div class="line">    display-&gt;power_off();  <span class="comment">// Cut power</span></div>
<div class="line">    <span class="comment">// ... later ...</span></div>
<div class="line">    display-&gt;power_on();   <span class="comment">// Restore power, requires re-init</span></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md51"></a>
Error Handling</h1>
<h2><a class="anchor" id="autotoc_md52"></a>
Using &lt;tt&gt;std::expected&lt;/tt&gt;</h2>
<p>All operations that can fail return <code>std::expected&lt;T, Error&gt;</code>:</p>
<div class="fragment"><div class="line"><span class="comment">// Check for errors</span></div>
<div class="line"><span class="keyword">auto</span> result = display-&gt;refresh();</div>
<div class="line"><span class="keywordflow">if</span> (!result) {</div>
<div class="line">    <span class="comment">// Error occurred</span></div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Error: &quot;</span> &lt;&lt; result.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Code: &quot;</span> &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(result.error().code) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// Success</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Refresh successful!\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Or use .value() (throws if error)</span></div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    display-&gt;refresh().value();</div>
<div class="line">} <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::bad_expected_access&lt;Error&gt;&amp; e) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Error: &quot;</span> &lt;&lt; e.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md53"></a>
Common Errors</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Error Code   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Recovery Strategy    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>DeviceNotInitialized</code>   </td><td class="markdownTableBodyNone">Hardware not initialized   </td><td class="markdownTableBodyNone">Call <code>device.init()</code> first    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>DeviceInitFailed</code>   </td><td class="markdownTableBodyNone">BCM2835 init failed   </td><td class="markdownTableBodyNone">Check permissions, hardware connection    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>DriverNotInitialized</code>   </td><td class="markdownTableBodyNone">Driver not initialized   </td><td class="markdownTableBodyNone">Call <code>driver.init(mode)</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>InvalidDisplayMode</code>   </td><td class="markdownTableBodyNone">Unsupported display mode   </td><td class="markdownTableBodyNone">Use <code>BlackWhite</code> or <code>Grayscale4</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>HardwareTimeout</code>   </td><td class="markdownTableBodyNone">Display BUSY timeout   </td><td class="markdownTableBodyNone">Check wiring, try again    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>RefreshFailed</code>   </td><td class="markdownTableBodyNone">Display refresh failed   </td><td class="markdownTableBodyNone">Retry with backoff    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>FileNotFound</code>   </td><td class="markdownTableBodyNone">Image file not found   </td><td class="markdownTableBodyNone">Check file path    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>InvalidFormat</code>   </td><td class="markdownTableBodyNone">Unsupported image format   </td><td class="markdownTableBodyNone">Use PNG/JPEG/BMP   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md54"></a>
Error Recovery Strategies</h2>
<p><b>1. Retry with Exponential Backoff:</b> </p><div class="fragment"><div class="line"><span class="keyword">auto</span> retry_refresh = [&amp;](<span class="keywordtype">int</span> max_attempts = 3) -&gt; std::expected&lt;void, Error&gt; {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> attempt = 1; attempt &lt;= max_attempts; ++attempt) {</div>
<div class="line">        <span class="keyword">auto</span> result = display-&gt;refresh();</div>
<div class="line">        <span class="keywordflow">if</span> (result) {</div>
<div class="line">            <span class="keywordflow">return</span> {};  <span class="comment">// Success</span></div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (attempt &lt; max_attempts) {</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;Attempt &quot;</span> &lt;&lt; attempt &lt;&lt; <span class="stringliteral">&quot; failed, retrying...\n&quot;</span>;</div>
<div class="line">            std::this_thread::sleep_for(std::chrono::milliseconds(100 * attempt));</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">return</span> result;  <span class="comment">// Give up, return error</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> {};</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>2. Fallback to Error Screen:</b> </p><div class="fragment"><div class="line"><span class="keyword">auto</span> result = display-&gt;refresh();</div>
<div class="line"><span class="keywordflow">if</span> (!result) {</div>
<div class="line">    <span class="comment">// Clear and show error</span></div>
<div class="line">    display-&gt;clear(Color::White);</div>
<div class="line">    display-&gt;draw_string(10, 10, <span class="stringliteral">&quot;Error:&quot;</span>, Font::font16(),</div>
<div class="line">                        Color::Black, Color::White);</div>
<div class="line">    display-&gt;draw_string(10, 30, result.error().what(), Font::font12(),</div>
<div class="line">                        Color::Black, Color::White);</div>
<div class="line">    display-&gt;refresh();  <span class="comment">// Try again with error message</span></div>
<div class="line">}</div>
</div><!-- fragment --><p><b>3. Graceful Degradation:</b> </p><div class="fragment"><div class="line"><span class="keyword">auto</span> result = display-&gt;draw_bitmap_from_file(10, 10, <span class="stringliteral">&quot;logo.png&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!result) {</div>
<div class="line">    <span class="comment">// Fall back to text</span></div>
<div class="line">    display-&gt;draw_string(10, 10, <span class="stringliteral">&quot;LOGO&quot;</span>, Font::font24(),</div>
<div class="line">                        Color::Black, Color::White);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md55"></a>
Advanced Topics</h1>
<h2><a class="anchor" id="autotoc_md56"></a>
Framebuffer Direct Access</h2>
<p>For advanced users who need direct pixel manipulation:</p>
<div class="fragment"><div class="line"><span class="comment">// Access framebuffer directly</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> y = 0; y &lt; display-&gt;effective_height(); ++y) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> x = 0; x &lt; display-&gt;effective_width(); ++x) {</div>
<div class="line">        <a class="code hl_enumeration" href="../../db/da4/namespaceepaper.html#abbcfe3e537fe42c69ae050cbfb36fcc3">Color</a> color = display-&gt;get_pixel(x, y);</div>
<div class="line">        <span class="comment">// ... process or modify ...</span></div>
<div class="line">        display-&gt;set_pixel(x, y, color);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Use Cases:</b></p><ul>
<li>Custom image processing</li>
<li>Algorithmic art generation</li>
<li>Performance-critical operations</li>
</ul>
<p><b>Warning:</b> Direct access bypasses orientation transforms. Use carefully!</p>
<h2><a class="anchor" id="autotoc_md57"></a>
Custom Drawing Functions</h2>
<p>Build your own drawing primitives on top of <code>set_pixel()</code>:</p>
<div class="fragment"><div class="line"><span class="comment">// Draw a triangle</span></div>
<div class="line"><span class="keywordtype">void</span> draw_triangle(<a class="code hl_class" href="../../d2/da8/classepaper_1_1Display.html">Display</a>&amp; display, <span class="keywordtype">size_t</span> x1, <span class="keywordtype">size_t</span> y1,</div>
<div class="line">                  <span class="keywordtype">size_t</span> x2, <span class="keywordtype">size_t</span> y2, <span class="keywordtype">size_t</span> x3, <span class="keywordtype">size_t</span> y3, <a class="code hl_enumeration" href="../../db/da4/namespaceepaper.html#abbcfe3e537fe42c69ae050cbfb36fcc3">Color</a> color) {</div>
<div class="line">    display.<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a591cf641178f0709277538ae0bf0a072">draw_line</a>(x1, y1, x2, y2, color);</div>
<div class="line">    display.<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a591cf641178f0709277538ae0bf0a072">draw_line</a>(x2, y2, x3, y3, color);</div>
<div class="line">    display.<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a591cf641178f0709277538ae0bf0a072">draw_line</a>(x3, y3, x1, y1, color);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a star</span></div>
<div class="line"><span class="keywordtype">void</span> draw_star(<a class="code hl_class" href="../../d2/da8/classepaper_1_1Display.html">Display</a>&amp; display, <span class="keywordtype">size_t</span> cx, <span class="keywordtype">size_t</span> cy, <span class="keywordtype">size_t</span> r, <a class="code hl_enumeration" href="../../db/da4/namespaceepaper.html#abbcfe3e537fe42c69ae050cbfb36fcc3">Color</a> color) {</div>
<div class="line">    <span class="comment">// ... calculate star points ...</span></div>
<div class="line">    <span class="comment">// ... use draw_line() ...</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassepaper_1_1Display_html"><div class="ttname"><a href="../../d2/da8/classepaper_1_1Display.html">epaper::Display</a></div><div class="ttdef"><b>Definition</b> display.hpp:111</div></div>
<div class="ttc" id="aclassepaper_1_1Display_html_a591cf641178f0709277538ae0bf0a072"><div class="ttname"><a href="../../d2/da8/classepaper_1_1Display.html#a591cf641178f0709277538ae0bf0a072">epaper::Display::draw_line</a></div><div class="ttdeci">auto draw_line(std::size_t x_start, std::size_t y_start, std::size_t x_end, std::size_t y_end, Color color, DotPixel line_width=DotPixel::Pixel1x1, LineStyle style=LineStyle::Solid) -&gt; void</div><div class="ttdoc">Draw a line between two points.</div><div class="ttdef"><b>Definition</b> display.cpp:258</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md58"></a>
Performance Optimization</h2>
<p><b>Batch Drawing Operations:</b> </p><div class="fragment"><div class="line"><span class="comment">// Good: Batch all drawing, then refresh once</span></div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a1656f9bdd5b7b9eb77c198e0ee8e578d">clear</a>(Color::White);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; item : items) {</div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ace222f7b3f8c846a3cf1ad160681c808">draw_string</a>(10, item.y, item.text, Font::font12(),</div>
<div class="line">                        Color::Black, Color::White);</div>
<div class="line">}</div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a324f2aeca58fabccc2082b021e12901f">refresh</a>();  <span class="comment">// Single refresh</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Bad: Refresh after each draw (very slow!)</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; item : items) {</div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ace222f7b3f8c846a3cf1ad160681c808">draw_string</a>(10, item.y, item.text, Font::font12(),</div>
<div class="line">                        Color::Black, Color::White);</div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a324f2aeca58fabccc2082b021e12901f">refresh</a>();  <span class="comment">// ❌ Don&#39;t do this! ~2s each!</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassepaper_1_1Display_html_a1656f9bdd5b7b9eb77c198e0ee8e578d"><div class="ttname"><a href="../../d2/da8/classepaper_1_1Display.html#a1656f9bdd5b7b9eb77c198e0ee8e578d">epaper::Display::clear</a></div><div class="ttdeci">auto clear(Color color=Color::White) -&gt; void</div><div class="ttdoc">Clear entire display to specified color.</div><div class="ttdef"><b>Definition</b> display.cpp:161</div></div>
<div class="ttc" id="aclassepaper_1_1Display_html_a324f2aeca58fabccc2082b021e12901f"><div class="ttname"><a href="../../d2/da8/classepaper_1_1Display.html#a324f2aeca58fabccc2082b021e12901f">epaper::Display::refresh</a></div><div class="ttdeci">auto refresh() -&gt; std::expected&lt; void, Error &gt;</div><div class="ttdoc">Send framebuffer to display and refresh.</div><div class="ttdef"><b>Definition</b> display.cpp:197</div></div>
<div class="ttc" id="aclassepaper_1_1Display_html_ace222f7b3f8c846a3cf1ad160681c808"><div class="ttname"><a href="../../d2/da8/classepaper_1_1Display.html#ace222f7b3f8c846a3cf1ad160681c808">epaper::Display::draw_string</a></div><div class="ttdeci">auto draw_string(std::size_t x, std::size_t y, std::string_view text, const Font &amp;font, Color foreground, Color background) -&gt; void</div><div class="ttdoc">Draw a text string.</div><div class="ttdef"><b>Definition</b> display.cpp:394</div></div>
</div><!-- fragment --><p><b>Minimize Refreshes:</b> </p><div class="fragment"><div class="line"><span class="comment">// Update display every 5 seconds</span></div>
<div class="line"><span class="keyword">auto</span> last_refresh = std::chrono::steady_clock::now();</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> refresh_interval = std::chrono::seconds(5);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (running) {</div>
<div class="line">    <span class="keyword">auto</span> now = std::chrono::steady_clock::now();</div>
<div class="line">    <span class="keywordflow">if</span> (now - last_refresh &gt;= refresh_interval) {</div>
<div class="line">        <span class="comment">// Fetch new data</span></div>
<div class="line">        <span class="keyword">auto</span> data = fetch_data();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Update display</span></div>
<div class="line">        display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a1656f9bdd5b7b9eb77c198e0ee8e578d">clear</a>(Color::White);</div>
<div class="line">        render_data(display, data);</div>
<div class="line">        display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a324f2aeca58fabccc2082b021e12901f">refresh</a>();</div>
<div class="line"> </div>
<div class="line">        last_refresh = now;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    std::this_thread::sleep_for(std::chrono::milliseconds(100));</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md59"></a>
Best Practices</h1>
<h2><a class="anchor" id="autotoc_md60"></a>
1. Keep Auto-Sleep Enabled</h2>
<div class="fragment"><div class="line"><span class="comment">// ✅ Good: Auto-sleep enabled (default)</span></div>
<div class="line"><span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Portrait0, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ❌ Bad: Disabled without good reason</span></div>
<div class="line"><span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Portrait0, <span class="keyword">false</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md61"></a>
2. Always Check Initialization</h2>
<div class="fragment"><div class="line"><span class="comment">// ✅ Good: Check every expected result</span></div>
<div class="line"><span class="keyword">auto</span> device_result = device.<a class="code hl_function" href="../../d2/d80/classepaper_1_1Device.html#ae0a60dbaca6d6c4e442982338748bcbb">init</a>();</div>
<div class="line"><span class="keywordflow">if</span> (!device_result) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Init failed: &quot;</span> &lt;&lt; device_result.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ❌ Bad: Ignore errors</span></div>
<div class="line">device.<a class="code hl_function" href="../../d2/d80/classepaper_1_1Device.html#ae0a60dbaca6d6c4e442982338748bcbb">init</a>();  <span class="comment">// What if this fails?</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md62"></a>
3. Batch Drawing Operations</h2>
<div class="fragment"><div class="line"><span class="comment">// ✅ Good: Draw everything, then refresh once</span></div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a1656f9bdd5b7b9eb77c198e0ee8e578d">clear</a>(Color::White);</div>
<div class="line">draw_header(display);</div>
<div class="line">draw_content(display);</div>
<div class="line">draw_footer(display);</div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a324f2aeca58fabccc2082b021e12901f">refresh</a>();  <span class="comment">// Single refresh</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// ❌ Bad: Multiple refreshes (~2s each!)</span></div>
<div class="line">draw_header(display);</div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a324f2aeca58fabccc2082b021e12901f">refresh</a>();</div>
<div class="line">draw_content(display);</div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a324f2aeca58fabccc2082b021e12901f">refresh</a>();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md63"></a>
4. Use Appropriate Fonts</h2>
<div class="fragment"><div class="line"><span class="comment">// ✅ Good: Font size matches purpose</span></div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ace222f7b3f8c846a3cf1ad160681c808">draw_string</a>(10, 10, <span class="stringliteral">&quot;Title&quot;</span>, Font::font24(), ...);      <span class="comment">// Large title</span></div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ace222f7b3f8c846a3cf1ad160681c808">draw_string</a>(10, 40, <span class="stringliteral">&quot;Body text&quot;</span>, Font::font12(), ...);  <span class="comment">// Body text</span></div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ace222f7b3f8c846a3cf1ad160681c808">draw_string</a>(10, 150, <span class="stringliteral">&quot;Footer&quot;</span>, Font::font8(), ...);     <span class="comment">// Small footer</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// ❌ Bad: Wrong font sizes</span></div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ace222f7b3f8c846a3cf1ad160681c808">draw_string</a>(10, 10, <span class="stringliteral">&quot;Title&quot;</span>, Font::font8(), ...);  <span class="comment">// Too small!</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md64"></a>
5. Handle Errors Gracefully</h2>
<div class="fragment"><div class="line"><span class="comment">// ✅ Good: Fallback on error</span></div>
<div class="line"><span class="keyword">auto</span> result = display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a54b27944906bfd49813afc7be3135817">draw_bitmap_from_file</a>(10, 10, <span class="stringliteral">&quot;icon.png&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!result) {</div>
<div class="line">    <span class="comment">// Fallback to text</span></div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ace222f7b3f8c846a3cf1ad160681c808">draw_string</a>(10, 10, <span class="stringliteral">&quot;[IMG]&quot;</span>, Font::font16(), ...);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ❌ Bad: Crash on error</span></div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a54b27944906bfd49813afc7be3135817">draw_bitmap_from_file</a>(10, 10, <span class="stringliteral">&quot;icon.png&quot;</span>).value();  <span class="comment">// May throw!</span></div>
<div class="ttc" id="aclassepaper_1_1Display_html_a54b27944906bfd49813afc7be3135817"><div class="ttname"><a href="../../d2/da8/classepaper_1_1Display.html#a54b27944906bfd49813afc7be3135817">epaper::Display::draw_bitmap_from_file</a></div><div class="ttdeci">auto draw_bitmap_from_file(std::size_t x, std::size_t y, std::string_view file_path, std::size_t target_width=0, std::size_t target_height=0) -&gt; std::expected&lt; void, Error &gt;</div><div class="ttdoc">Load and draw a bitmap from file.</div><div class="ttdef"><b>Definition</b> display.cpp:511</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md65"></a>
Common Patterns</h1>
<h2><a class="anchor" id="autotoc_md66"></a>
Pattern: Status Dashboard</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> render_dashboard(<a class="code hl_class" href="../../d2/da8/classepaper_1_1Display.html">Display</a>&amp; display, <span class="keyword">const</span> SystemStatus&amp; status) {</div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a1656f9bdd5b7b9eb77c198e0ee8e578d">clear</a>(Color::White);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Title bar</span></div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a6e1ffde615e4ec0b8088fe762111d945">draw_rectangle</a>(0, 0, display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#adb0a192366d6be73346c04e9d7c6b589">effective_width</a>(), 30,</div>
<div class="line">                           Color::Black, DrawFill::Full);</div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ace222f7b3f8c846a3cf1ad160681c808">draw_string</a>(10, 8, <span class="stringliteral">&quot;System Status&quot;</span>, Font::font16(),</div>
<div class="line">                        Color::White, Color::Black);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Status indicators</span></div>
<div class="line">    <span class="keywordtype">size_t</span> y = 40;</div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ace222f7b3f8c846a3cf1ad160681c808">draw_string</a>(10, y, <span class="stringliteral">&quot;CPU:&quot;</span>, Font::font12(), Color::Black, Color::White);</div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ac0c7446f83bde58ff3ac1f1ceaee35c5">draw_decimal</a>(80, y, status.cpu_usage, 1, Font::font12(),</div>
<div class="line">                         Color::Black, Color::White);</div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ace222f7b3f8c846a3cf1ad160681c808">draw_string</a>(120, y, <span class="stringliteral">&quot;%&quot;</span>, Font::font12(), Color::Black, Color::White);</div>
<div class="line"> </div>
<div class="line">    y += 20;</div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ace222f7b3f8c846a3cf1ad160681c808">draw_string</a>(10, y, <span class="stringliteral">&quot;Temp:&quot;</span>, Font::font12(), Color::Black, Color::White);</div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ac0c7446f83bde58ff3ac1f1ceaee35c5">draw_decimal</a>(80, y, status.temperature, 1, Font::font12(),</div>
<div class="line">                         Color::Black, Color::White);</div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ace222f7b3f8c846a3cf1ad160681c808">draw_string</a>(120, y, <span class="stringliteral">&quot;C&quot;</span>, Font::font12(), Color::Black, Color::White);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Connection indicator</span></div>
<div class="line">    <span class="keywordflow">if</span> (status.connected) {</div>
<div class="line">        display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#aa1d090d0bf15c818f5451086860cd0d0">draw_circle</a>(250, 10, 5, Color::White, DrawFill::Full);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a324f2aeca58fabccc2082b021e12901f">refresh</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassepaper_1_1Display_html_a6e1ffde615e4ec0b8088fe762111d945"><div class="ttname"><a href="../../d2/da8/classepaper_1_1Display.html#a6e1ffde615e4ec0b8088fe762111d945">epaper::Display::draw_rectangle</a></div><div class="ttdeci">auto draw_rectangle(std::size_t x_start, std::size_t y_start, std::size_t x_end, std::size_t y_end, Color color, DotPixel line_width=DotPixel::Pixel1x1, DrawFill fill=DrawFill::Empty) -&gt; void</div><div class="ttdoc">Draw a rectangle.</div><div class="ttdef"><b>Definition</b> display.cpp:297</div></div>
<div class="ttc" id="aclassepaper_1_1Display_html_aa1d090d0bf15c818f5451086860cd0d0"><div class="ttname"><a href="../../d2/da8/classepaper_1_1Display.html#aa1d090d0bf15c818f5451086860cd0d0">epaper::Display::draw_circle</a></div><div class="ttdeci">auto draw_circle(std::size_t x_center, std::size_t y_center, std::size_t radius, Color color, DotPixel line_width=DotPixel::Pixel1x1, DrawFill fill=DrawFill::Empty) -&gt; void</div><div class="ttdoc">Draw a circle.</div><div class="ttdef"><b>Definition</b> display.cpp:322</div></div>
<div class="ttc" id="aclassepaper_1_1Display_html_ac0c7446f83bde58ff3ac1f1ceaee35c5"><div class="ttname"><a href="../../d2/da8/classepaper_1_1Display.html#ac0c7446f83bde58ff3ac1f1ceaee35c5">epaper::Display::draw_decimal</a></div><div class="ttdeci">auto draw_decimal(std::size_t x, std::size_t y, double number, std::uint8_t decimal_places, const Font &amp;font, Color foreground, Color background) -&gt; void</div><div class="ttdoc">Draw a decimal number with specified precision.</div><div class="ttdef"><b>Definition</b> display.cpp:418</div></div>
<div class="ttc" id="aclassepaper_1_1Display_html_adb0a192366d6be73346c04e9d7c6b589"><div class="ttname"><a href="../../d2/da8/classepaper_1_1Display.html#adb0a192366d6be73346c04e9d7c6b589">epaper::Display::effective_width</a></div><div class="ttdeci">auto effective_width() const noexcept -&gt; std::size_t</div><div class="ttdoc">Get effective display width accounting for rotation.</div><div class="ttdef"><b>Definition</b> display.cpp:22</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md67"></a>
Pattern: Multi-Screen Rotation</h2>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> Screen { Overview, Details, Settings };</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> render_current_screen(<a class="code hl_class" href="../../d2/da8/classepaper_1_1Display.html">Display</a>&amp; display, Screen current, <span class="keyword">const</span> AppState&amp; state) {</div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a1656f9bdd5b7b9eb77c198e0ee8e578d">clear</a>(Color::White);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (current) {</div>
<div class="line">        <span class="keywordflow">case</span> Screen::Overview:</div>
<div class="line">            render_overview(display, state);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> Screen::Details:</div>
<div class="line">            render_details(display, state);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> Screen::Settings:</div>
<div class="line">            render_settings(display, state);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a324f2aeca58fabccc2082b021e12901f">refresh</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Main loop</span></div>
<div class="line">Screen current_screen = Screen::Overview;</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> flip_interval = std::chrono::seconds(10);</div>
<div class="line"><span class="keyword">auto</span> last_flip = std::chrono::steady_clock::now();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (running) {</div>
<div class="line">    <span class="keyword">auto</span> now = std::chrono::steady_clock::now();</div>
<div class="line">    <span class="keywordflow">if</span> (now - last_flip &gt;= flip_interval) {</div>
<div class="line">        <span class="comment">// Rotate to next screen</span></div>
<div class="line">        current_screen = <span class="keyword">static_cast&lt;</span>Screen<span class="keyword">&gt;</span>((<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(current_screen) + 1) % 3);</div>
<div class="line">        render_current_screen(display, current_screen, state);</div>
<div class="line">        last_flip = now;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    std::this_thread::sleep_for(std::chrono::milliseconds(100));</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md68"></a>
Pattern: Periodic Updates</h2>
<p>See the <a href="../../../examples/crypto_dashboard/">crypto dashboard example</a> for a complete real-world implementation.</p>
<h1><a class="anchor" id="autotoc_md69"></a>
Debugging &amp; Troubleshooting</h1>
<h2><a class="anchor" id="autotoc_md70"></a>
BMP Export for Debugging</h2>
<p><b>NEW:</b> Save your framebuffer to a BMP file for instant visual inspection without waiting for slow display refresh!</p>
<div class="fragment"><div class="line"><span class="comment">// Draw your content</span></div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a1656f9bdd5b7b9eb77c198e0ee8e578d">clear</a>(Color::White);</div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#ace222f7b3f8c846a3cf1ad160681c808">draw_string</a>(10, 10, <span class="stringliteral">&quot;Layout Test&quot;</span>, Font::font16(),</div>
<div class="line">                    Color::Black, Color::White);</div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a6e1ffde615e4ec0b8088fe762111d945">draw_rectangle</a>(5, 5, 250, 170, Color::Black, DrawFill::Empty);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Save to BMP for debugging (instant!)</span></div>
<div class="line"><span class="keyword">auto</span> result = display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a9ca4f3345cfb344ba30e770cb3046506">save_framebuffer_to_bmp</a>(<span class="stringliteral">&quot;debug_layout.bmp&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!result) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;BMP export failed: &quot;</span> &lt;&lt; result.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Now refresh to display (slow, ~2 seconds)</span></div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a324f2aeca58fabccc2082b021e12901f">refresh</a>();</div>
<div class="ttc" id="aclassepaper_1_1Display_html_a9ca4f3345cfb344ba30e770cb3046506"><div class="ttname"><a href="../../d2/da8/classepaper_1_1Display.html#a9ca4f3345cfb344ba30e770cb3046506">epaper::Display::save_framebuffer_to_bmp</a></div><div class="ttdeci">auto save_framebuffer_to_bmp(std::string_view filename) -&gt; std::expected&lt; void, Error &gt;</div><div class="ttdef"><b>Definition</b> display.cpp:578</div></div>
</div><!-- fragment --><p><b>Benefits:</b></p><ul>
<li><b>Instant feedback</b>: See your layout immediately without 2-second display refresh</li>
<li><b>Works anywhere</b>: View BMP on your computer, no display hardware needed</li>
<li><b>Perfect accuracy</b>: Shows exactly what will appear on display (with orientation)</li>
<li><b>Iterative development</b>: Quickly test different layouts</li>
</ul>
<p><b>Color mapping:</b></p><ul>
<li><b>BlackWhite mode</b>: Black→RGB(0,0,0), White→RGB(255,255,255)</li>
<li><b>Grayscale4 mode</b>: Black→RGB(0,0,0), Gray2→RGB(85,85,85), Gray1→RGB(170,170,170), White→RGB(255,255,255)</li>
</ul>
<p><b>Example workflow:</b> </p><div class="fragment"><div class="line"><span class="comment">// Rapid layout iteration without hardware</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> layout = 0; layout &lt; 5; ++layout) {</div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a1656f9bdd5b7b9eb77c198e0ee8e578d">clear</a>(Color::White);</div>
<div class="line">    render_layout(display, layout);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Save each layout variant</span></div>
<div class="line">    display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a9ca4f3345cfb344ba30e770cb3046506">save_framebuffer_to_bmp</a>(<span class="stringliteral">&quot;layout_&quot;</span> + std::to_string(layout) + <span class="stringliteral">&quot;.bmp&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Review all BMPs on computer, pick best one</span></div>
<div class="line"><span class="comment">// Then deploy to hardware</span></div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a1656f9bdd5b7b9eb77c198e0ee8e578d">clear</a>(Color::White);</div>
<div class="line">render_layout(display, best_layout);</div>
<div class="line">display-&gt;<a class="code hl_function" href="../../d2/da8/classepaper_1_1Display.html#a324f2aeca58fabccc2082b021e12901f">refresh</a>();  <span class="comment">// Only one slow refresh needed!</span></div>
</div><!-- fragment --><p>See <code>examples/bmp_debug_example.cpp</code> for a complete demonstration.</p>
<h2><a class="anchor" id="autotoc_md71"></a>
Display Not Responding</h2>
<p><b>Symptoms:</b> No output on display, or refresh hangs indefinitely.</p>
<p><b>Solutions:</b></p><ol type="1">
<li>Check hardware connections (especially BUSY pin)</li>
<li>Verify SPI is enabled: <code>sudo raspi-config</code> → Interface Options → SPI</li>
<li>Ensure running with <code>sudo</code> (GPIO access requires root)</li>
<li>Check display power supply (3.3V, sufficient current)</li>
</ol>
<h2><a class="anchor" id="autotoc_md72"></a>
Garbled Output</h2>
<p><b>Symptoms:</b> Random pixels, incorrect rendering.</p>
<p><b>Solutions:</b></p><ol type="1">
<li>Check SPI wiring (MOSI, SCLK must be correct)</li>
<li>Verify ground connection</li>
<li>Ensure display mode matches drawing colors</li>
<li>Check framebuffer isn't corrupted (clear before drawing)</li>
</ol>
<h2><a class="anchor" id="autotoc_md73"></a>
Slow Performance</h2>
<p><b>Symptoms:</b> Long delays, sluggish updates.</p>
<p><b>Solutions:</b></p><ol type="1">
<li>Batch drawing operations (single <code>refresh()</code> at end)</li>
<li>Reduce refresh frequency (e.g., 5-10 second intervals)</li>
<li>Profile code to find bottlenecks</li>
<li>Remember: e-paper refresh is inherently slow (~2s for EPD27)</li>
</ol>
<h2><a class="anchor" id="autotoc_md74"></a>
Memory Issues</h2>
<p><b>Symptoms:</b> Out of memory errors, crashes on Raspberry Pi Zero.</p>
<p><b>Solutions:</b></p><ol type="1">
<li>Use BlackWhite mode instead of Grayscale4 (half memory)</li>
<li>Don't load large images unnecessarily</li>
<li>Clear framebuffer when switching contexts</li>
<li>Consider using Raspberry Pi 3/4 (more RAM)</li>
</ol>
<h2><a class="anchor" id="autotoc_md75"></a>
Colors Not Displaying</h2>
<p><b>Symptoms:</b> Gray colors appear as black.</p>
<p><b>Solutions:</b></p><ol type="1">
<li>Verify using <code>Grayscale4</code> mode (not <code>BlackWhite</code>)</li>
<li>Check display supports grayscale (EPD27 does)</li>
<li>Ensure using <code>Color::Gray1</code> or <code>Color::Gray2</code> (not just <code>Black</code>/<code>White</code>)</li>
</ol>
<hr  />
<p><b>For architecture details, see <a class="el" href="../../d4/d34/md_docs_2ARCHITECTURE.html">ARCHITECTURE.md</a>.</b> <b>For driver development, see <a class="el" href="../../db/d9c/md_docs_2DRIVER.html">DRIVER.md</a>.</b> <b>For examples, see examples/README.md.</b> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
