<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libepaper: API Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libepaper<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">A modern C++23 library for controlling Waveshare e-paper displays on Raspberry Pi</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">API Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md16"></a> A comprehensive guide to using the libepaper API for e-paper display control.</p>
<h1><a class="anchor" id="autotoc_md17"></a>
Table of Contents</h1>
<ul>
<li>Getting Started</li>
<li>Display Creation &amp; Management</li>
<li>Drawing Operations</li>
<li>Color &amp; Grayscale</li>
<li>Display Refresh &amp; Power Management</li>
<li>Error Handling</li>
<li>Advanced Topics</li>
<li>Best Practices</li>
<li>Common Patterns</li>
<li>Troubleshooting</li>
</ul>
<h1><a class="anchor" id="autotoc_md18"></a>
Getting Started</h1>
<h2><a class="anchor" id="autotoc_md19"></a>
Requirements</h2>
<ul>
<li>Raspberry Pi with SPI enabled</li>
<li>C++23 capable compiler (GCC 14+ or Clang 18+)</li>
<li>libgpiod library installed (<code>sudo apt install libgpiod-dev</code>)</li>
<li>User in <code>gpio</code> and <code>spi</code> groups (no sudo required)</li>
</ul>
<h2><a class="anchor" id="autotoc_md20"></a>
Basic Setup</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d5/d08/device_8hpp.html">epaper/device.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d2/da4/display_8hpp.html">epaper/display.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d1/d76/epd27_8hpp.html">epaper/drivers/epd27.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/d50/font_8hpp.html">epaper/font.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../db/da4/namespaceepaper.html">epaper</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// 1. Initialize hardware device (with optional custom config)</span></div>
<div class="line">    <a class="code hl_class" href="../../d2/d80/classepaper_1_1Device.html">Device</a> device;  <span class="comment">// Uses default DeviceConfig</span></div>
<div class="line">    <span class="comment">// Or customize:</span></div>
<div class="line">    <span class="comment">// DeviceConfig config{</span></div>
<div class="line">    <span class="comment">//     .gpio_chip = &quot;/dev/gpiochip0&quot;,</span></div>
<div class="line">    <span class="comment">//     .spi_device = &quot;/dev/spidev0.0&quot;,</span></div>
<div class="line">    <span class="comment">//     .spi_speed_hz = 1953125</span></div>
<div class="line">    <span class="comment">// };</span></div>
<div class="line">    <span class="comment">// Device device{config};</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> result = device.<a class="code hl_function" href="../../d2/d80/classepaper_1_1Device.html#ae0a60dbaca6d6c4e442982338748bcbb">init</a>(); !result) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Device init failed: &quot;</span> &lt;&lt; result.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 2. Create display (auto-sleep enabled by default)</span></div>
<div class="line">    <span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(</div>
<div class="line">        device,</div>
<div class="line">        DisplayMode::BlackWhite,    <span class="comment">// or DisplayMode::Grayscale4</span></div>
<div class="line">        Orientation::Portrait0,      <span class="comment">// or Landscape90, Portrait180, Landscape270</span></div>
<div class="line">        <span class="keyword">true</span>                         <span class="comment">// auto-sleep enabled (recommended)</span></div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!display) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Display creation failed: &quot;</span> &lt;&lt; display.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 3. Draw something using builder pattern</span></div>
<div class="line">    display-&gt;clear(Color::White);</div>
<div class="line">    display-&gt;draw(</div>
<div class="line">        display-&gt;text(<span class="stringliteral">&quot;Hello World!&quot;</span>)</div>
<div class="line">            .at(10, 10)</div>
<div class="line">            .font(&amp;Font::font16())</div>
<div class="line">            .foreground(Color::Black)</div>
<div class="line">            .background(Color::White)</div>
<div class="line">            .build()</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 4. Refresh display (will auto-sleep after)</span></div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> result = display-&gt;refresh(); !result) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Refresh failed: &quot;</span> &lt;&lt; result.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassepaper_1_1Device_html"><div class="ttname"><a href="../../d2/d80/classepaper_1_1Device.html">epaper::Device</a></div><div class="ttdoc">RAII wrapper for GPIO and SPI device access.</div><div class="ttdef"><b>Definition</b> device.hpp:78</div></div>
<div class="ttc" id="aclassepaper_1_1Device_html_ae0a60dbaca6d6c4e442982338748bcbb"><div class="ttname"><a href="../../d2/d80/classepaper_1_1Device.html#ae0a60dbaca6d6c4e442982338748bcbb">epaper::Device::init</a></div><div class="ttdeci">auto init() -&gt; std::expected&lt; void, Error &gt;</div><div class="ttdoc">Initialize the GPIO (libgpiod) and SPI (SPIdev) interfaces.</div><div class="ttdef"><b>Definition</b> device.cpp:160</div></div>
<div class="ttc" id="adevice_8hpp_html"><div class="ttname"><a href="../../d5/d08/device_8hpp.html">device.hpp</a></div></div>
<div class="ttc" id="adisplay_8hpp_html"><div class="ttname"><a href="../../d2/da4/display_8hpp.html">display.hpp</a></div></div>
<div class="ttc" id="aepd27_8hpp_html"><div class="ttname"><a href="../../d1/d76/epd27_8hpp.html">epd27.hpp</a></div></div>
<div class="ttc" id="afont_8hpp_html"><div class="ttname"><a href="../../df/d50/font_8hpp.html">font.hpp</a></div></div>
<div class="ttc" id="anamespaceepaper_html"><div class="ttname"><a href="../../db/da4/namespaceepaper.html">epaper</a></div><div class="ttdef"><b>Definition</b> color.hpp:5</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21"></a>
Your First Program</h2>
<p>Here's a complete minimal example that draws a rectangle with text:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d5/d08/device_8hpp.html">epaper/device.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d2/da4/display_8hpp.html">epaper/display.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d1/d76/epd27_8hpp.html">epaper/drivers/epd27.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/d50/font_8hpp.html">epaper/font.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../db/da4/namespaceepaper.html">epaper</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">// Initialize device</span></div>
<div class="line">    <a class="code hl_class" href="../../d2/d80/classepaper_1_1Device.html">Device</a> device;</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> result = device.<a class="code hl_function" href="../../d2/d80/classepaper_1_1Device.html#ae0a60dbaca6d6c4e442982338748bcbb">init</a>(); !result) {</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create display in landscape orientation</span></div>
<div class="line">    <span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(</div>
<div class="line">        device,</div>
<div class="line">        DisplayMode::BlackWhite,</div>
<div class="line">        Orientation::Landscape90</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!display) {</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Clear screen to white</span></div>
<div class="line">    display-&gt;clear(Color::White);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Draw a border rectangle</span></div>
<div class="line">    display-&gt;draw(</div>
<div class="line">        display-&gt;rectangle()</div>
<div class="line">            .top_left(0, 0)</div>
<div class="line">            .bottom_right(display-&gt;effective_width() - 1,</div>
<div class="line">                         display-&gt;effective_height() - 1)</div>
<div class="line">            .color(Color::Black)</div>
<div class="line">            .fill(DrawFill::Empty)</div>
<div class="line">            .build()</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Draw title</span></div>
<div class="line">    display-&gt;draw(</div>
<div class="line">        display-&gt;text(<span class="stringliteral">&quot;My First E-Paper App&quot;</span>)</div>
<div class="line">            .at(10, 10)</div>
<div class="line">            .font(&amp;Font::font20())</div>
<div class="line">            .foreground(Color::Black)</div>
<div class="line">            .background(Color::White)</div>
<div class="line">            .build()</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Draw a filled rectangle</span></div>
<div class="line">    display-&gt;draw(</div>
<div class="line">        display-&gt;rectangle()</div>
<div class="line">            .top_left(10, 40)</div>
<div class="line">            .bottom_right(100, 80)</div>
<div class="line">            .color(Color::Black)</div>
<div class="line">            .fill(DrawFill::Full)</div>
<div class="line">            .build()</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Draw text on black background</span></div>
<div class="line">    display-&gt;draw(</div>
<div class="line">        display-&gt;text(<span class="stringliteral">&quot;libepaper&quot;</span>)</div>
<div class="line">            .at(15, 50)</div>
<div class="line">            .font(&amp;Font::font12())</div>
<div class="line">            .foreground(Color::White)</div>
<div class="line">            .background(Color::Black)</div>
<div class="line">            .build()</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Refresh display</span></div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> result = display-&gt;refresh(); !result) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Refresh failed\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Display updated successfully!\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Compile and run:</b> </p><div class="fragment"><div class="line"># Build</div>
<div class="line">cmake --build build</div>
<div class="line"> </div>
<div class="line"># Run (no sudo required with proper group membership)</div>
<div class="line">./build/your_program</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md22"></a>
Display Creation &amp; Management</h1>
<h2><a class="anchor" id="autotoc_md23"></a>
Creating a Display</h2>
<p>Use the factory function <code>create_display&lt;Driver&gt;()</code> to create displays:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d2/da4/display_8hpp.html">epaper/display.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d1/d76/epd27_8hpp.html">epaper/drivers/epd27.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(</div>
<div class="line">    device,                      <span class="comment">// Hardware device</span></div>
<div class="line">    DisplayMode::BlackWhite,     <span class="comment">// Display mode</span></div>
<div class="line">    Orientation::Landscape90,    <span class="comment">// Orientation</span></div>
<div class="line">    <span class="keyword">true</span>                         <span class="comment">// Auto-sleep enabled</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Returns std::expected&lt;std::unique_ptr&lt;Display&gt;, Error&gt;</span></div>
<div class="line"><span class="keywordflow">if</span> (!display) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed: &quot;</span> &lt;&lt; display.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use with -&gt; operator</span></div>
<div class="line">display-&gt;draw(display-&gt;point().at(10, 10).color(Color::Black).build());</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md24"></a>
Display Modes</h2>
<p>The library supports two display modes:</p>
<h3><a class="anchor" id="autotoc_md25"></a>
BlackWhite Mode (1 bit per pixel)</h3>
<p>Pure binary output - only black and white pixels.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(</div>
<div class="line">    device,</div>
<div class="line">    DisplayMode::BlackWhite,</div>
<div class="line">    Orientation::Portrait0</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Only these colors work in BlackWhite mode:</span></div>
<div class="line">display-&gt;draw(display-&gt;point().at(10, 10).color(Color::White).build());  <span class="comment">// White pixel</span></div>
<div class="line">display-&gt;draw(display-&gt;point().at(20, 20).color(Color::Black).build());  <span class="comment">// Black pixel</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Gray colors will be converted to black</span></div>
<div class="line">display-&gt;draw(display-&gt;point().at(30, 30).color(Color::Gray1).build());  <span class="comment">// → Black</span></div>
<div class="line">display-&gt;draw(display-&gt;point().at(40, 40).color(Color::Gray2).build());  <span class="comment">// → Black</span></div>
</div><!-- fragment --><p><b>When to use:</b></p><ul>
<li>Highest contrast output</li>
<li>Text-heavy displays</li>
<li>Smaller memory footprint (5,808 bytes for 2.7")
- Faster SPI transfers

@subsubsection autotoc_md26 Grayscale4 Mode (2 bits per pixel)

Four-level grayscale output.

@icode{cpp} 
auto display = create_display&lt;EPD27&gt;(
    device,
    DisplayMode::Grayscale4,
    Orientation::Portrait0
);

// All four gray levels available:
display-&gt;draw(display-&gt;point().at(10, 10).color(Color::White).build());  // Lightest
display-&gt;draw(display-&gt;point().at(20, 20).color(Color::Gray1).build());  // Light gray
display-&gt;draw(display-&gt;point().at(30, 30).color(Color::Gray2).build());  // Dark gray
display-&gt;draw(display-&gt;point().at(40, 40).color(Color::Black).build());  // Darkest
@endicode 

&lt;strong&gt;When to use:&lt;/strong&gt;
- Images and photographs
- Charts with multiple data series
- Anti-aliased graphics
- More nuanced visual output

&lt;strong&gt;Trade-offs:&lt;/strong&gt;
- Double memory usage (11,616 bytes for 2.7")</li>
<li>Slightly slower SPI transfer</li>
<li>Better visual quality</li>
</ul>
<h2><a class="anchor" id="autotoc_md27"></a>
Orientation</h2>
<p>The library supports four orientations with automatic coordinate transformation:</p>
<div class="fragment"><div class="line"><span class="comment">// Portrait (default) - 176x264 pixels</span></div>
<div class="line"><span class="keyword">auto</span> display1 = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Portrait0);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Landscape (90° clockwise) - 264x176 pixels</span></div>
<div class="line"><span class="keyword">auto</span> display2 = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Landscape90);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Upside-down portrait (180°) - 176x264 pixels</span></div>
<div class="line"><span class="keyword">auto</span> display3 = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Portrait180);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Landscape counter-clockwise (270°) - 264x176 pixels</span></div>
<div class="line"><span class="keyword">auto</span> display4 = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Landscape270);</div>
</div><!-- fragment --><p><b>Coordinate Transformation:</b></p>
<p>The coordinate system is automatically transformed. Point (0, 0) is always the top-left corner in the <em>rotated</em> coordinate space.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Landscape90);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get effective dimensions (accounts for rotation)</span></div>
<div class="line"><span class="keyword">auto</span> width = display-&gt;effective_width();    <span class="comment">// 264 (rotated!)</span></div>
<div class="line"><span class="keyword">auto</span> height = display-&gt;effective_height();  <span class="comment">// 176 (rotated!)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw at &quot;top-left&quot; in rotated space</span></div>
<div class="line">display-&gt;draw(display-&gt;point().at(0, 0).color(Color::Black).build());  <span class="comment">// Appears at actual top-left</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// All drawing operations use rotated coordinates</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;rectangle()</div>
<div class="line">        .top_left(0, 0)</div>
<div class="line">        .bottom_right(width - 1, height - 1)</div>
<div class="line">        .color(Color::Black)</div>
<div class="line">        .fill(DrawFill::Empty)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
</div><!-- fragment --><p><b>Orientation Summary:</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Orientation   </th><th class="markdownTableHeadNone">Rotation   </th><th class="markdownTableHeadNone">Width×Height   </th><th class="markdownTableHeadNone">Top-Left (0,0) Maps To    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Portrait0   </td><td class="markdownTableBodyNone">0°   </td><td class="markdownTableBodyNone">176×264   </td><td class="markdownTableBodyNone">Physical top-left    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Landscape90   </td><td class="markdownTableBodyNone">90° CW   </td><td class="markdownTableBodyNone">264×176   </td><td class="markdownTableBodyNone">Physical top-right    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Portrait180   </td><td class="markdownTableBodyNone">180°   </td><td class="markdownTableBodyNone">176×264   </td><td class="markdownTableBodyNone">Physical bottom-right    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Landscape270   </td><td class="markdownTableBodyNone">270° CW   </td><td class="markdownTableBodyNone">264×176   </td><td class="markdownTableBodyNone">Physical bottom-left   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md28"></a>
Drawing Operations</h1>
<p>All drawing operations are <b>noexcept</b> and never fail. Out-of-bounds coordinates are silently clipped.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
Framebuffered Drawing (Atomic Updates)</h2>
<p>All drawing happens off-screen in an in-memory framebuffer. Calls like <code>draw(...)</code> only update this buffer; nothing is sent to the panel until you call <code>refresh()</code>. This gives:</p><ul>
<li>Tear/flicker-free updates (no incremental drawing on-screen)</li>
<li>Batched SPI transfers for performance</li>
<li>Fewer panel updates, reducing ghosting and wear</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// Compose the frame in memory</span></div>
<div class="line">display-&gt;clear(Color::White);</div>
<div class="line">display-&gt;draw(display-&gt;rect(10, 10, 80, 40).fill(Color::Black).build());</div>
<div class="line">display-&gt;draw(display-&gt;text(<span class="stringliteral">&quot;Hello&quot;</span>).at(20, 70).build());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Paint it once, atomically</span></div>
<div class="line">display-&gt;refresh();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md30"></a>
Points</h2>
<div class="fragment"><div class="line"><span class="comment">// Draw a single pixel</span></div>
<div class="line">display-&gt;draw(display-&gt;point().at(x, y).color(Color::Black).build());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a larger point (2x2, 3x3, 4x4, 5x5 pixels)</span></div>
<div class="line">display-&gt;draw(display-&gt;point().at(x, y).color(Color::Black).size(DotPixel::Pixel2x2).build());</div>
<div class="line">display-&gt;draw(display-&gt;point().at(x, y).color(Color::Black).size(DotPixel::Pixel3x3).build());</div>
<div class="line">display-&gt;draw(display-&gt;point().at(x, y).color(Color::Black).size(DotPixel::Pixel4x4).build());</div>
<div class="line">display-&gt;draw(display-&gt;point().at(x, y).color(Color::Black).size(DotPixel::Pixel5x5).build());</div>
</div><!-- fragment --><p><b>DotPixel enum:</b></p><ul>
<li><code>Pixel1x1</code>: Single pixel (default)</li>
<li><code>Pixel2x2</code>: 2×2 pixel block</li>
<li><code>Pixel3x3</code>: 3×3 pixel block</li>
<li><code>Pixel4x4</code>: 4×4 pixel block</li>
<li><code>Pixel5x5</code>: 5×5 pixel block</li>
</ul>
<h2><a class="anchor" id="autotoc_md31"></a>
Lines</h2>
<div class="fragment"><div class="line"><span class="comment">// Draw a line from (x1, y1) to (x2, y2)</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;line()</div>
<div class="line">        .from(x1, y1)</div>
<div class="line">        .to(x2, y2)</div>
<div class="line">        .color(Color::Black)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thicker lines</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;line()</div>
<div class="line">        .from(x1, y1)</div>
<div class="line">        .to(x2, y2)</div>
<div class="line">        .color(Color::Black)</div>
<div class="line">        .width(DotPixel::Pixel2x2)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Dotted lines</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;line()</div>
<div class="line">        .from(x1, y1)</div>
<div class="line">        .to(x2, y2)</div>
<div class="line">        .color(Color::Black)</div>
<div class="line">        .width(DotPixel::Pixel1x1)</div>
<div class="line">        .style(LineStyle::Dotted)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
</div><!-- fragment --><p><b>LineStyle enum:</b></p><ul>
<li><code>Solid</code>: Continuous line (default)</li>
<li><code>Dotted</code>: Dot every 4 pixels</li>
</ul>
<p><b>Examples:</b> </p><div class="fragment"><div class="line"><span class="comment">// Draw a grid</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> x = 0; x &lt; display-&gt;effective_width(); x += 20) {</div>
<div class="line">    display-&gt;draw(</div>
<div class="line">        display-&gt;line()</div>
<div class="line">            .from(x, 0)</div>
<div class="line">            .to(x, display-&gt;effective_height() - 1)</div>
<div class="line">            .color(Color::Black)</div>
<div class="line">            .build()</div>
<div class="line">    );</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> y = 0; y &lt; display-&gt;effective_height(); y += 20) {</div>
<div class="line">    display-&gt;draw(</div>
<div class="line">        display-&gt;line()</div>
<div class="line">            .from(0, y)</div>
<div class="line">            .to(display-&gt;effective_width() - 1, y)</div>
<div class="line">            .color(Color::Black)</div>
<div class="line">            .build()</div>
<div class="line">    );</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md32"></a>
Rectangles</h2>
<div class="fragment"><div class="line"><span class="comment">// Draw a rectangle outline</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;rectangle()</div>
<div class="line">        .top_left(x, y)</div>
<div class="line">        .bottom_right(width, height)</div>
<div class="line">        .color(Color::Black)</div>
<div class="line">        .fill(DrawFill::Empty)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a filled rectangle</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;rectangle()</div>
<div class="line">        .top_left(x, y)</div>
<div class="line">        .bottom_right(width, height)</div>
<div class="line">        .color(Color::Black)</div>
<div class="line">        .fill(DrawFill::Full)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thicker borders</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;rectangle()</div>
<div class="line">        .top_left(x, y)</div>
<div class="line">        .bottom_right(width, height)</div>
<div class="line">        .color(Color::Black)</div>
<div class="line">        .fill(DrawFill::Empty)</div>
<div class="line">        .border_width(DotPixel::Pixel2x2)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
</div><!-- fragment --><p><b>Parameters:</b></p><ul>
<li><code>x, y</code>: Top-left corner</li>
<li><code>width, height</code>: Rectangle dimensions</li>
<li><code>color</code>: Color to draw</li>
<li><code>fill</code>: <code>DrawFill::Empty</code> (outline) or <code>DrawFill::Full</code> (filled)</li>
<li><code>pixel</code>: Line thickness (default: <code>Pixel1x1</code>)</li>
</ul>
<p><b>Examples:</b> </p><div class="fragment"><div class="line"><span class="comment">// Draw a button</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;rectangle()</div>
<div class="line">        .top_left(10, 10)</div>
<div class="line">        .bottom_right(100, 40)</div>
<div class="line">        .color(Color::Black)</div>
<div class="line">        .fill(DrawFill::Empty)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text(<span class="stringliteral">&quot;OK&quot;</span>)</div>
<div class="line">        .at(30, 20)</div>
<div class="line">        .font(&amp;Font::font16())</div>
<div class="line">        .foreground(Color::Black)</div>
<div class="line">        .background(Color::White)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a filled header bar</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;rectangle()</div>
<div class="line">        .top_left(0, 0)</div>
<div class="line">        .bottom_right(display-&gt;effective_width(), 30)</div>
<div class="line">        .color(Color::Black)</div>
<div class="line">        .fill(DrawFill::Full)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text(<span class="stringliteral">&quot;Dashboard&quot;</span>)</div>
<div class="line">        .at(10, 8)</div>
<div class="line">        .font(&amp;Font::font16())</div>
<div class="line">        .foreground(Color::White)</div>
<div class="line">        .background(Color::Black)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md33"></a>
Circles</h2>
<div class="fragment"><div class="line"><span class="comment">// Draw a circle outline</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;circle()</div>
<div class="line">        .center(center_x, center_y)</div>
<div class="line">        .radius(radius)</div>
<div class="line">        .color(Color::Black)</div>
<div class="line">        .fill(DrawFill::Empty)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a filled circle</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;circle()</div>
<div class="line">        .center(center_x, center_y)</div>
<div class="line">        .radius(radius)</div>
<div class="line">        .color(Color::Black)</div>
<div class="line">        .fill(DrawFill::Full)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thicker outline</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;circle()</div>
<div class="line">        .center(center_x, center_y)</div>
<div class="line">        .radius(radius)</div>
<div class="line">        .color(Color::Black)</div>
<div class="line">        .fill(DrawFill::Empty)</div>
<div class="line">        .border_width(DotPixel::Pixel2x2)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
</div><!-- fragment --><p><b>Examples:</b> </p><div class="fragment"><div class="line"><span class="comment">// Draw a bullseye</span></div>
<div class="line">display-&gt;draw(display-&gt;circle().center(88, 132).radius(50).color(Color::Black).fill(DrawFill::Empty).build());</div>
<div class="line">display-&gt;draw(display-&gt;circle().center(88, 132).radius(40).color(Color::Black).fill(DrawFill::Empty).build());</div>
<div class="line">display-&gt;draw(display-&gt;circle().center(88, 132).radius(30).color(Color::Black).fill(DrawFill::Empty).build());</div>
<div class="line">display-&gt;draw(display-&gt;circle().center(88, 132).radius(10).color(Color::Black).fill(DrawFill::Full).build());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a status indicator (filled dot)</span></div>
<div class="line"><span class="keywordflow">if</span> (connected) {</div>
<div class="line">    display-&gt;draw(</div>
<div class="line">        display-&gt;circle()</div>
<div class="line">            .center(250, 10)</div>
<div class="line">            .radius(5)</div>
<div class="line">            .color(Color::Black)</div>
<div class="line">            .fill(DrawFill::Full)</div>
<div class="line">            .build()</div>
<div class="line">    );</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md34"></a>
Text &amp; Fonts</h2>
<div class="fragment"><div class="line"><span class="comment">// Draw text</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text(<span class="stringliteral">&quot;Hello World!&quot;</span>)</div>
<div class="line">        .at(x, y)</div>
<div class="line">        .font(&amp;Font::font16())</div>
<div class="line">        .foreground(Color::Black)</div>
<div class="line">        .background(Color::White)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Different font sizes</span></div>
<div class="line">display-&gt;draw(display-&gt;text(<span class="stringliteral">&quot;Tiny&quot;</span>).at(10, 10).font(&amp;Font::font8()).foreground(Color::Black).background(Color::White).build());</div>
<div class="line">display-&gt;draw(display-&gt;text(<span class="stringliteral">&quot;Small&quot;</span>).at(10, 30).font(&amp;Font::font12()).foreground(Color::Black).background(Color::White).build());</div>
<div class="line">display-&gt;draw(display-&gt;text(<span class="stringliteral">&quot;Medium&quot;</span>).at(10, 50).font(&amp;Font::font16()).foreground(Color::Black).background(Color::White).build());</div>
<div class="line">display-&gt;draw(display-&gt;text(<span class="stringliteral">&quot;Large&quot;</span>).at(10, 80).font(&amp;Font::font20()).foreground(Color::Black).background(Color::White).build());</div>
<div class="line">display-&gt;draw(display-&gt;text(<span class="stringliteral">&quot;XLarge&quot;</span>).at(10, 110).font(&amp;Font::font24()).foreground(Color::Black).background(Color::White).build());</div>
</div><!-- fragment --><p><b>Available Fonts:</b></p><ul>
<li><code>Font::font8()</code>: 5×8 pixels per character</li>
<li><code>Font::font12()</code>: 7×12 pixels per character</li>
<li><code>Font::font16()</code>: 11×16 pixels per character</li>
<li><code>Font::font20()</code>: 14×20 pixels per character</li>
<li><code>Font::font24()</code>: 17×24 pixels per character</li>
</ul>
<p><b>Foreground/Background Colors:</b> </p><div class="fragment"><div class="line"><span class="comment">// Black text on white background</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text(<span class="stringliteral">&quot;Normal&quot;</span>)</div>
<div class="line">        .at(10, 10)</div>
<div class="line">        .font(&amp;Font::font16())</div>
<div class="line">        .foreground(Color::Black)</div>
<div class="line">        .background(Color::White)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// White text on black background (inverse)</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text(<span class="stringliteral">&quot;Inverse&quot;</span>)</div>
<div class="line">        .at(10, 30)</div>
<div class="line">        .font(&amp;Font::font16())</div>
<div class="line">        .foreground(Color::White)</div>
<div class="line">        .background(Color::Black)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Gray text (in grayscale mode)</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text(<span class="stringliteral">&quot;Gray&quot;</span>)</div>
<div class="line">        .at(10, 50)</div>
<div class="line">        .font(&amp;Font::font16())</div>
<div class="line">        .foreground(Color::Gray2)</div>
<div class="line">        .background(Color::White)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
</div><!-- fragment --><p><b>Multi-line Text:</b> </p><div class="fragment"><div class="line"><span class="comment">// Manual line spacing</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> x = 10;</div>
<div class="line"><span class="keywordtype">size_t</span> y = 10;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> line_height = 20;</div>
<div class="line"> </div>
<div class="line">display-&gt;draw(display-&gt;text(<span class="stringliteral">&quot;Line 1&quot;</span>).at(x, y).font(&amp;Font::font16()).foreground(Color::Black).background(Color::White).build());</div>
<div class="line">y += line_height;</div>
<div class="line">display-&gt;draw(display-&gt;text(<span class="stringliteral">&quot;Line 2&quot;</span>).at(x, y).font(&amp;Font::font16()).foreground(Color::Black).background(Color::White).build());</div>
<div class="line">y += line_height;</div>
<div class="line">display-&gt;draw(display-&gt;text(<span class="stringliteral">&quot;Line 3&quot;</span>).at(x, y).font(&amp;Font::font16()).foreground(Color::Black).background(Color::White).build());</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md35"></a>
Numbers</h2>
<div class="fragment"><div class="line"><span class="comment">// Draw an integer using TextBuilder</span></div>
<div class="line"><span class="keywordtype">int</span> value = 42;</div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text()</div>
<div class="line">        .at(x, y)</div>
<div class="line">        .number(value)</div>
<div class="line">        .font(&amp;Font::font16())</div>
<div class="line">        .foreground(Color::Black)</div>
<div class="line">        .background(Color::White)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a decimal with precision</span></div>
<div class="line"><span class="keywordtype">double</span> pi = 3.14159;</div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text()</div>
<div class="line">        .at(x, y)</div>
<div class="line">        .decimal(pi, 3)  <span class="comment">// 3 decimal places</span></div>
<div class="line">        .font(&amp;Font::font16())</div>
<div class="line">        .foreground(Color::Black)</div>
<div class="line">        .background(Color::White)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line"><span class="comment">// Displays: &quot;3.141&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Right-aligned numbers (for tables)</span></div>
<div class="line"><span class="keywordtype">int</span> price = 199;</div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text()</div>
<div class="line">        .at(200, y)</div>
<div class="line">        .number(price)</div>
<div class="line">        .font(&amp;Font::font12())</div>
<div class="line">        .foreground(Color::Black)</div>
<div class="line">        .background(Color::White)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
</div><!-- fragment --><p><b>Formatting Examples:</b> </p><div class="fragment"><div class="line"><span class="comment">// Display sensor readings</span></div>
<div class="line"><span class="keywordtype">double</span> temperature = 23.5;</div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text(<span class="stringliteral">&quot;Temperature:&quot;</span>)</div>
<div class="line">        .at(10, 10)</div>
<div class="line">        .font(&amp;Font::font12())</div>
<div class="line">        .foreground(Color::Black)</div>
<div class="line">        .background(Color::White)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text()</div>
<div class="line">        .at(110, 10)</div>
<div class="line">        .decimal(temperature, 1)</div>
<div class="line">        .font(&amp;Font::font12())</div>
<div class="line">        .foreground(Color::Black)</div>
<div class="line">        .background(Color::White)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text(<span class="stringliteral">&quot;C&quot;</span>)</div>
<div class="line">        .at(150, 10)</div>
<div class="line">        .font(&amp;Font::font12())</div>
<div class="line">        .foreground(Color::Black)</div>
<div class="line">        .background(Color::White)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Display prices</span></div>
<div class="line"><span class="keywordtype">double</span> price = 19.99;</div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text(<span class="stringliteral">&quot;$&quot;</span>)</div>
<div class="line">        .at(10, 30)</div>
<div class="line">        .font(&amp;Font::font16())</div>
<div class="line">        .foreground(Color::Black)</div>
<div class="line">        .background(Color::White)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text()</div>
<div class="line">        .at(20, 30)</div>
<div class="line">        .decimal(price, 2)</div>
<div class="line">        .font(&amp;Font::font16())</div>
<div class="line">        .foreground(Color::Black)</div>
<div class="line">        .background(Color::White)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md36"></a>
Bitmaps</h2>
<div class="fragment"><div class="line"><span class="comment">// Draw from raw pixel data</span></div>
<div class="line">std::vector&lt;Color&gt; pixels = {</div>
<div class="line">    Color::Black, Color::White, Color::Black, Color::White,</div>
<div class="line">    Color::White, Color::Black, Color::White, Color::Black,</div>
<div class="line">    Color::Black, Color::White, Color::Black, Color::White,</div>
<div class="line">    Color::White, Color::Black, Color::White, Color::Black</div>
<div class="line">};</div>
<div class="line">display-&gt;draw_bitmap(10, 10, pixels, 4, 4);  <span class="comment">// 4×4 checkerboard</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw from image file (PNG, JPEG, BMP, etc.)</span></div>
<div class="line"><span class="keyword">auto</span> result = display-&gt;draw_bitmap_from_file(10, 50, <span class="stringliteral">&quot;logo.png&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!result) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to load image: &quot;</span> &lt;&lt; result.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw with scaling</span></div>
<div class="line">display-&gt;draw_bitmap_from_file(10, 100, <span class="stringliteral">&quot;photo.jpg&quot;</span>, 200, 150);  <span class="comment">// Scale to 200×150</span></div>
</div><!-- fragment --><p><b>Supported Image Formats:</b></p><ul>
<li>PNG (including transparency)</li>
<li>JPEG</li>
<li>BMP</li>
<li>TGA</li>
<li>GIF (first frame only)</li>
<li>PSD (composited view)</li>
<li>HDR</li>
</ul>
<p><b>Automatic Color Conversion:</b></p>
<p>The library automatically converts color images to your display's mode:</p>
<ol type="1">
<li><b>RGB to Grayscale</b>: Uses standard perceptual formula (0.299×R + 0.587×G + 0.114×B)</li>
<li><b>Quantization</b>:<ul>
<li><b>BlackWhite mode</b>: 50% brightness threshold (gray ≥ 128 → White)</li>
<li><b>Grayscale4 mode</b>: 4-level mapping (0-63→Black, 64-127→Gray2, 128-191→Gray1, 192-255→White)</li>
</ul>
</li>
</ol>
<p>This means you can load <b>any color image</b> (photos, graphics, screenshots) and the library intelligently converts it to work with your e-paper display:</p>
<div class="fragment"><div class="line"><span class="comment">// Load a full-color photograph - automatically converted!</span></div>
<div class="line">display-&gt;draw_bitmap_from_file(10, 10, <span class="stringliteral">&quot;vacation_photo.jpg&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Load a colorful logo - automatically converted!</span></div>
<div class="line">display-&gt;draw_bitmap_from_file(100, 50, <span class="stringliteral">&quot;company_logo.png&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// No manual color processing needed!</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md37"></a>
Color &amp; Grayscale</h1>
<h2><a class="anchor" id="autotoc_md38"></a>
Color Enum</h2>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> <a class="code hl_enumeration" href="../../db/da4/namespaceepaper.html#abbcfe3e537fe42c69ae050cbfb36fcc3">Color</a> {</div>
<div class="line">    White,  <span class="comment">// Value: 0 (lightest)</span></div>
<div class="line">    Gray1,  <span class="comment">// Value: 1 (light gray, grayscale mode only)</span></div>
<div class="line">    Gray2,  <span class="comment">// Value: 2 (dark gray, grayscale mode only)</span></div>
<div class="line">    Black   <span class="comment">// Value: 3 (darkest)</span></div>
<div class="line">};</div>
<div class="ttc" id="anamespaceepaper_html_abbcfe3e537fe42c69ae050cbfb36fcc3"><div class="ttname"><a href="../../db/da4/namespaceepaper.html#abbcfe3e537fe42c69ae050cbfb36fcc3">epaper::Color</a></div><div class="ttdeci">Color</div><div class="ttdoc">Color representation for e-paper displays.</div><div class="ttdef"><b>Definition</b> display.hpp:35</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md39"></a>
Color Mapping by Display Mode</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Color   </th><th class="markdownTableHeadNone">BlackWhite Mode   </th><th class="markdownTableHeadNone">Grayscale4 Mode    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">White   </td><td class="markdownTableBodyNone">White (0)   </td><td class="markdownTableBodyNone">White (0)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Gray1   </td><td class="markdownTableBodyNone">Black (1)   </td><td class="markdownTableBodyNone">Light gray (1)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Gray2   </td><td class="markdownTableBodyNone">Black (1)   </td><td class="markdownTableBodyNone">Dark gray (2)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Black   </td><td class="markdownTableBodyNone">Black (1)   </td><td class="markdownTableBodyNone">Black (3)   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md40"></a>
Working with Grayscale</h2>
<div class="fragment"><div class="line"><span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(device, DisplayMode::Grayscale4,</div>
<div class="line">                                     Orientation::Portrait0);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a grayscale gradient</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> x = 0; x &lt; display-&gt;effective_width(); x++) {</div>
<div class="line">    <a class="code hl_enumeration" href="../../db/da4/namespaceepaper.html#abbcfe3e537fe42c69ae050cbfb36fcc3">Color</a> shade;</div>
<div class="line">    <span class="keywordflow">if</span> (x &lt; 44) shade = Color::White;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &lt; 88) shade = Color::Gray1;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &lt; 132) shade = Color::Gray2;</div>
<div class="line">    <span class="keywordflow">else</span> shade = Color::Black;</div>
<div class="line"> </div>
<div class="line">    display-&gt;draw(</div>
<div class="line">        display-&gt;line()</div>
<div class="line">            .from(x, 0)</div>
<div class="line">            .to(x, display-&gt;effective_height() - 1)</div>
<div class="line">            .color(shade)</div>
<div class="line">            .build()</div>
<div class="line">    );</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw anti-aliased graphics</span></div>
<div class="line"><span class="comment">// (manually, by using intermediate gray levels at edges)</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md41"></a>
Display Refresh &amp; Power Management</h1>
<h2><a class="anchor" id="autotoc_md42"></a>
Refresh Behavior</h2>
<p>Call <code>refresh()</code> to update the physical display with the framebuffer contents.</p>
<div class="fragment"><div class="line"><span class="comment">// Draw operations modify the framebuffer</span></div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;text(<span class="stringliteral">&quot;Hello&quot;</span>)</div>
<div class="line">        .at(10, 10)</div>
<div class="line">        .font(&amp;Font::font16())</div>
<div class="line">        .foreground(Color::Black)</div>
<div class="line">        .background(Color::White)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line">display-&gt;draw(</div>
<div class="line">    display-&gt;circle()</div>
<div class="line">        .center(88, 132)</div>
<div class="line">        .radius(30)</div>
<div class="line">        .color(Color::Black)</div>
<div class="line">        .fill(DrawFill::Full)</div>
<div class="line">        .build()</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Nothing appears on screen yet...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Refresh to display</span></div>
<div class="line"><span class="keyword">auto</span> result = display-&gt;refresh();</div>
<div class="line"><span class="keywordflow">if</span> (!result) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Refresh failed: &quot;</span> &lt;&lt; result.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Now the screen shows the updates!</span></div>
</div><!-- fragment --><p><b>Important:</b> <code>refresh()</code> is a <b>blocking operation</b> that takes ~2 seconds for the EPD27.</p>
<h2><a class="anchor" id="autotoc_md43"></a>
Auto-Sleep (IMPORTANT!)</h2>
<p><b>The library automatically manages sleep/wake cycles to prevent screen burn-in.</b></p>
<div class="fragment"><div class="line"><span class="comment">// Create display with auto-sleep enabled (default and recommended)</span></div>
<div class="line"><span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Portrait0, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// First render</span></div>
<div class="line">display-&gt;draw(display-&gt;text(<span class="stringliteral">&quot;Frame 1&quot;</span>).at(10, 10).font(&amp;Font::font16()).foreground(Color::Black).background(Color::White).build());</div>
<div class="line">display-&gt;refresh();  <span class="comment">// Display automatically enters sleep mode after refresh</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// ... minutes or hours later ...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Second render - transparent wake!</span></div>
<div class="line">display-&gt;draw(display-&gt;text(<span class="stringliteral">&quot;Frame 2&quot;</span>).at(10, 10).font(&amp;Font::font16()).foreground(Color::Black).background(Color::White).build());</div>
<div class="line">display-&gt;refresh();  <span class="comment">// Library auto-wakes if needed, then refreshes ✨</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// No manual wake() calls needed!</span></div>
</div><!-- fragment --><p><b>How It Works:</b></p><ol type="1">
<li>After <code>refresh()</code>, display automatically sleeps (if auto-sleep enabled)</li>
<li>Driver internally tracks sleep state with <code>is_asleep_</code> flag</li>
<li>Next <code>refresh()</code> automatically calls <code>wake()</code> if asleep</li>
<li><code>wake()</code> re-initializes the EPD27 hardware (~2 second delay)</li>
<li>Refresh proceeds normally</li>
</ol>
<p><b>Why Auto-Sleep?</b></p><ul>
<li><b>Prevents burn-in</b>: E-paper displays degrade if left in high voltage state</li>
<li><b>Follows manufacturer recommendation</b>: Waveshare recommends sleep between refreshes</li>
<li><b>Transparent</b>: Library handles everything automatically</li>
<li><b>Safe</b>: No risk of forgetting to sleep</li>
</ul>
<p><b>Benefits of Transparent Wake:</b></p><ul>
<li><b>Ergonomic</b>: No manual sleep/wake management</li>
<li><b>Correct</b>: Impossible to forget to wake</li>
<li><b>Simple</b>: Same code works for all scenarios</li>
</ul>
<h2><a class="anchor" id="autotoc_md44"></a>
Disabling Auto-Sleep</h2>
<p>For special use cases where you need manual control:</p>
<div class="fragment"><div class="line"><span class="comment">// Disable auto-sleep</span></div>
<div class="line"><span class="keyword">auto</span> display = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,</div>
<div class="line">                                     Orientation::Portrait0, <span class="keyword">false</span>);  <span class="comment">// false = disabled</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Now you must manually manage sleep</span></div>
<div class="line">display-&gt;refresh();  <span class="comment">// Does NOT auto-sleep</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Manual sleep (when you&#39;re done)</span></div>
<div class="line">display-&gt;sleep();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Manual wake before next refresh</span></div>
<div class="line">display-&gt;wake();  <span class="comment">// Required! EPD27 needs re-init (~2s)</span></div>
<div class="line">display-&gt;refresh();</div>
</div><!-- fragment --><p><b>When to disable auto-sleep:</b></p><ul>
<li>Rapid successive refreshes (e.g., animation, though not recommended for e-paper)</li>
<li>Custom power management logic</li>
<li>Benchmarking/testing</li>
</ul>
<p><b>Recommendation:</b> Keep auto-sleep <b>enabled</b> (default). It prevents hardware damage and the library handles wake automatically.</p>
<h2><a class="anchor" id="autotoc_md45"></a>
Manual Power Control</h2>
<p>The library also provides explicit power control methods:</p>
<div class="fragment"><div class="line"><span class="comment">// Put display to sleep (usually automatic with auto-sleep)</span></div>
<div class="line">display-&gt;sleep();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Wake from sleep (usually automatic on next refresh)</span></div>
<div class="line">display-&gt;wake();  <span class="comment">// EPD27: ~2 second re-initialization</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Complete power off (if supported by hardware)</span></div>
<div class="line"><span class="keywordflow">if</span> (display-&gt;supports_power_control()) {</div>
<div class="line">    display-&gt;power_off();  <span class="comment">// Cut power</span></div>
<div class="line">    <span class="comment">// ... later ...</span></div>
<div class="line">    display-&gt;power_on();   <span class="comment">// Restore power, requires re-init</span></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md46"></a>
Error Handling</h1>
<h2><a class="anchor" id="autotoc_md47"></a>
Using &lt;tt&gt;std::expected&lt;/tt&gt;</h2>
<p>All operations that can fail return <code>std::expected&lt;T, Error&gt;</code>:</p>
<div class="fragment"><div class="line"><span class="comment">// Check for errors</span></div>
<div class="line"><span class="keyword">auto</span> result = display-&gt;refresh();</div>
<div class="line"><span class="keywordflow">if</span> (!result) {</div>
<div class="line">    <span class="comment">// Error occurred</span></div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Error: &quot;</span> &lt;&lt; result.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Code: &quot;</span> &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(result.error().code) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// Success</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Refresh successful!\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Or use .value() (throws if error)</span></div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    display-&gt;refresh().value();</div>
<div class="line">} <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::bad_expected_access&lt;Error&gt;&amp; e) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Error: &quot;</span> &lt;&lt; e.error().what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md48"></a>
Common Errors</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Error Code   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Recovery Strategy    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>DeviceNotInitialized</code>   </td><td class="markdownTableBodyNone">Hardware not initialized   </td><td class="markdownTableBodyNone">Call <code>device.init()</code> first    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>DeviceInitFailed</code>   </td><td class="markdownTableBodyNone">Device initialization failed   </td><td class="markdownTableBodyNone">Check permissions, hardware connection, group membership    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>DriverNotInitialized</code>   </td><td class="markdownTableBodyNone">Driver not initialized   </td><td class="markdownTableBodyNone">Call <code>driver.init(mode)</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>InvalidDisplayMode</code>   </td><td class="markdownTableBodyNone">Unsupported display mode   </td><td class="markdownTableBodyNone">Use <code>BlackWhite</code> or <code>Grayscale4</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>HardwareTimeout</code>   </td><td class="markdownTableBodyNone">Display BUSY timeout   </td><td class="markdownTableBodyNone">Check wiring, try again    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>RefreshFailed</code>   </td><td class="markdownTableBodyNone">Display refresh failed   </td><td class="markdownTableBodyNone">Retry with backoff    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>FileNotFound</code>   </td><td class="markdownTableBodyNone">Image file not found   </td><td class="markdownTableBodyNone">Check file path    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>InvalidFormat</code>   </td><td class="markdownTableBodyNone">Unsupported image format   </td><td class="markdownTableBodyNone">Use PNG/JPEG/BMP   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md49"></a>
Error Recovery Strategies</h2>
<p><b>1. Retry with Exponential Backoff:</b> </p><div class="fragment"><div class="line"><span class="keyword">auto</span> retry_refresh = [&amp;](<span class="keywordtype">int</span> max_attempts = 3) -&gt; std::expected&lt;void, Error&gt; {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> attempt = 1; attempt &lt;= max_attempts; ++attempt) {</div>
<div class="line">        <span class="keyword">auto</span> result = display-&gt;refresh();</div>
<div class="line">        <span class="keywordflow">if</span> (result) {</div>
<div class="line">            <span class="keywordflow">return</span> {};  <span class="comment">// Success</span></div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (attempt &lt; max_attempts) {</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;Attempt &quot;</span> &lt;&lt; attempt &lt;&lt; <span class="stringliteral">&quot; failed, retrying...\n&quot;</span>;</div>
<div class="line">            std::this_thread::sleep_for(std::chrono::milliseconds(100 * attempt));</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">return</span> result;  <span class="comment">// Give up, return error</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> {};</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>2. Fallback to Error Screen:</b> </p><div class="fragment"><div class="line"><span class="keyword">auto</span> result = display-&gt;refresh();</div>
<div class="line"><span class="keywordflow">if</span> (!result) {</div>
<div class="line">    <span class="comment">// Clear and show error</span></div>
<div class="line">    display-&gt;clear(Color::White);</div>
<div class="line">    display-&gt;draw(</div>
<div class="line">        display-&gt;text(<span class="stringliteral">&quot;Error:&quot;</span>)</div>
<div class="line">            .at(10, 10)</div>
<div class="line">            .font(&amp;Font::font16())</div>
<div class="line">            .foreground(Color::Black)</div>
<div class="line">            .background(Color::White)</div>
<div class="line">            .build()</div>
<div class="line">    );</div>
<div class="line">    display-&gt;draw(</div>
<div class="line">        display-&gt;text(result.error().what())</div>
<div class="line">            .at(10, 30)</div>
<div class="line">            .font(&amp;Font::font12())</div>
<div class="line">            .foreground(Color::Black)</div>
<div class="line">            .background(Color::White)</div>
<div class="line">            .build()</div>
<div class="line">    );</div>
<div class="line">    display-&gt;refresh();  <span class="comment">// Try again with error message</span></div>
<div class="line">}</div>
</div><!-- fragment --><p><b>3. Graceful Degradation:</b> </p><div class="fragment"><div class="line"><span class="keyword">auto</span> result = display-&gt;draw_bitmap_from_file(10, 10, <span class="stringliteral">&quot;logo.png&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!result) {</div>
<div class="line">    <span class="comment">// Fall back to text</span></div>
<div class="line">    display-&gt;draw(</div>
<div class="line">        display-&gt;text(<span class="stringliteral">&quot;LOGO&quot;</span>)</div>
<div class="line">            .at(10, 10)</div>
<div class="line">            .font(&amp;Font::font24())</div>
<div class="line">            .foreground(Color::Black)</div>
<div class="line">            .background(Color::White)</div>
<div class="line">            .build()</div>
<div class="line">    );</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md50"></a>
Advanced Topics</h1>
<h2><a class="anchor" id="autotoc_md51"></a>
Button Handling</h2>
<p>The <code>Device</code> class provides GPIO operations that can be used to handle buttons on your e-paper display (e.g., Waveshare 2.7" includes KEY1, KEY2, KEY3 buttons).

&lt;strong&gt;Basic Button Reading:&lt;/strong&gt;

@icode{cpp} 
#include &lt;epaper/device.hpp&gt;
#include &lt;thread&gt;
#include &lt;chrono&gt;
#include &lt;iostream&gt;

using namespace epaper;

// Define button pins (check your hardware documentation for actual pin numbers)
namespace button_pins {
    constexpr Pin KEY1{5};   // Example: GPIO 5
    constexpr Pin KEY2{6};   // Example: GPIO 6
    constexpr Pin KEY3{13};  // Example: GPIO 13
}

int main() {
    Device device;
    device.init().value();

    // Configure buttons as inputs
    device.set_pin_input(button_pins::KEY1);
    device.set_pin_input(button_pins::KEY2);
    device.set_pin_input(button_pins::KEY3);

    // Poll button state
    while (true) {
        if (device.read_pin(button_pins::KEY1)) {
            std::cout &lt;&lt; "KEY1 pressed<br  />
";
            // Handle button press
        }
        if (device.read_pin(button_pins::KEY2)) {
            std::cout &lt;&lt; "KEY2 pressed<br  />
";
        }
        if (device.read_pin(button_pins::KEY3)) {
            std::cout &lt;&lt; "KEY3 pressed<br  />
";
        }

        std::this_thread::sleep_for(std::chrono::milliseconds(50)); // Debounce
    }
}
@endicode 

&lt;strong&gt;Note:&lt;/strong&gt; Button pin numbers vary by hardware. Check your Waveshare display documentation for the correct GPIO pin assignments. The library provides the GPIO API; you implement the button handling logic.

@subsection autotoc_md52 Framebuffer Direct Access

For advanced users who need direct pixel manipulation:

@icode{cpp} 
// Access framebuffer directly
for (size_t y = 0; y &lt; display-&gt;effective_height(); ++y) {
    for (size_t x = 0; x &lt; display-&gt;effective_width(); ++x) {
        Color color = display-&gt;get_pixel(x, y);
        // ... process or modify ...
        display-&gt;set_pixel(x, y, color);
    }
}
@endicode 

&lt;strong&gt;Use Cases:&lt;/strong&gt;
- Custom image processing
- Algorithmic art generation
- Performance-critical operations

&lt;strong&gt;Warning:&lt;/strong&gt; Direct access bypasses orientation transforms. Use carefully!

@subsection autotoc_md53 Custom Drawing Functions

Build your own drawing primitives on top of &lt;tt&gt;set_pixel()&lt;/tt&gt;:

@icode{cpp} 
// Draw a triangle
void draw_triangle(Display&amp; display, size_t x1, size_t y1,
                  size_t x2, size_t y2, size_t x3, size_t y3, Color color) {
    display.draw(display.line().from(x1, y1).to(x2, y2).color(color).build());
    display.draw(display.line().from(x2, y2).to(x3, y3).color(color).build());
    display.draw(display.line().from(x3, y3).to(x1, y1).color(color).build());
}

// Draw a star
void draw_star(Display&amp; display, size_t cx, size_t cy, size_t r, Color color) {
    // ... calculate star points ...
    // ... use display.line().from().to().color().build() ...
}
@endicode 

@subsection autotoc_md54 Performance Optimization

&lt;strong&gt;Batch Drawing Operations:&lt;/strong&gt;
@icode{cpp} 
// Good: Batch all drawing, then refresh once
display-&gt;clear(Color::White);
for (const auto&amp; item : items) {
    display-&gt;draw(
        display-&gt;text(item.text)
            .at(10, item.y)
            .font(&amp;Font::font12())
            .foreground(Color::Black)
            .background(Color::White)
            .build()
    );
}
display-&gt;refresh();  // Single refresh

// Bad: Refresh after each draw (very slow!)
for (const auto&amp; item : items) {
    display-&gt;draw(
        display-&gt;text(item.text)
            .at(10, item.y)
            .font(&amp;Font::font12())
            .foreground(Color::Black)
            .background(Color::White)
            .build()
    );
    display-&gt;refresh();  // ❌ Don't do this! ~2s each!
}
@endicode 

&lt;strong&gt;Minimize Refreshes:&lt;/strong&gt;
@icode{cpp} 
// Update display every 5 seconds
auto last_refresh = std::chrono::steady_clock::now();
const auto refresh_interval = std::chrono::seconds(5);

while (running) {
    auto now = std::chrono::steady_clock::now();
    if (now - last_refresh &gt;= refresh_interval) {
        // Fetch new data
        auto data = fetch_data();

        // Update display
        display-&gt;clear(Color::White);
        render_data(display, data);
        display-&gt;refresh();

        last_refresh = now;
    }

    std::this_thread::sleep_for(std::chrono::milliseconds(100));
}
@endicode 

@section autotoc_md55 Best Practices

@subsection autotoc_md56 1. Keep Auto-Sleep Enabled

@icode{cpp} 
// ✅ Good: Auto-sleep enabled (default)
auto display = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,
                                     Orientation::Portrait0, true);

// ❌ Bad: Disabled without good reason
auto display = create_display&lt;EPD27&gt;(device, DisplayMode::BlackWhite,
                                     Orientation::Portrait0, false);
@endicode 

@subsection autotoc_md57 2. Always Check Initialization

@icode{cpp} 
// ✅ Good: Check every expected result
auto device_result = device.init();
if (!device_result) {
    std::cerr &lt;&lt; "Init failed: " &lt;&lt; device_result.error().what() &lt;&lt; "<br  />
";
    return 1;
}

// ❌ Bad: Ignore errors
device.init();  // What if this fails?
@endicode 

@subsection autotoc_md58 3. Batch Drawing Operations

@icode{cpp} 
// ✅ Good: Draw everything, then refresh once
display-&gt;clear(Color::White);
draw_header(display);
draw_content(display);
draw_footer(display);
display-&gt;refresh();  // Single refresh

// ❌ Bad: Multiple refreshes (~2s each!)
draw_header(display);
display-&gt;refresh();
draw_content(display);
display-&gt;refresh();
@endicode 

@subsection autotoc_md59 4. Use Appropriate Fonts

@icode{cpp} 
// ✅ Good: Font size matches purpose
display-&gt;draw(display-&gt;text("Title").at(10, 10).font(&amp;Font::font24())...);      // Large title
display-&gt;draw(display-&gt;text("Body text").at(10, 40).font(&amp;Font::font12())...);  // Body text
display-&gt;draw(display-&gt;text("Footer").at(10, 150).font(&amp;Font::font8())...);     // Small footer

// ❌ Bad: Wrong font sizes
display-&gt;draw(display-&gt;text("Title").at(10, 10).font(&amp;Font::font8())...);  // Too small!
@endicode 

@subsection autotoc_md60 5. Handle Errors Gracefully

@icode{cpp} 
// ✅ Good: Fallback on error
auto result = display-&gt;draw_bitmap_from_file(10, 10, "icon.png");
if (!result) {
    // Fallback to text
    display-&gt;draw(display-&gt;text("[IMG]").at(10, 10).font(&amp;Font::font16())...);
}

// ❌ Bad: Crash on error
display-&gt;draw_bitmap_from_file(10, 10, "icon.png").value();  // May throw!
@endicode 

@section autotoc_md61 Common Patterns

@subsection autotoc_md62 Pattern: Status Dashboard

@icode{cpp} 
void render_dashboard(Display&amp; display, const SystemStatus&amp; status) {
    display-&gt;clear(Color::White);

    // Title bar
    display-&gt;draw(
        display-&gt;rectangle()
            .top_left(0, 0)
            .bottom_right(display-&gt;effective_width(), 30)
            .color(Color::Black)
            .fill(DrawFill::Full)
            .build()
    );
    display-&gt;draw(
        display-&gt;text("System Status")
            .at(10, 8)
            .font(&amp;Font::font16())
            .foreground(Color::White)
            .background(Color::Black)
            .build()
    );

    // Status indicators
    size_t y = 40;
    display-&gt;draw(display-&gt;text("CPU:").at(10, y).font(&amp;Font::font12()).foreground(Color::Black).background(Color::White).build());
    display-&gt;draw(display-&gt;text("").at(80, y).decimal(status.cpu_usage, 1).font(&amp;Font::font12()).foreground(Color::Black).background(Color::White).build());
    display-&gt;draw(display-&gt;text("%").at(120, y).font(&amp;Font::font12()).foreground(Color::Black).background(Color::White).build());

    y += 20;
    display-&gt;draw(display-&gt;text("Temp:").at(10, y).font(&amp;Font::font12()).foreground(Color::Black).background(Color::White).build());
    display-&gt;draw(display-&gt;text("").at(80, y).decimal(status.temperature, 1).font(&amp;Font::font12()).foreground(Color::Black).background(Color::White).build());
    display-&gt;draw(display-&gt;text("C").at(120, y).font(&amp;Font::font12()).foreground(Color::Black).background(Color::White).build());

    // Connection indicator
    if (status.connected) {
        display-&gt;draw(
            display-&gt;circle()
                .center(250, 10)
                .radius(5)
                .color(Color::White)
                .fill(DrawFill::Full)
                .build()
        );
    }

    display-&gt;refresh();
}
@endicode 

@subsection autotoc_md63 Pattern: Multi-Screen Rotation

@icode{cpp} 
enum class Screen { Overview, Details, Settings };

void render_current_screen(Display&amp; display, Screen current, const AppState&amp; state) {
    display-&gt;clear(Color::White);

    switch (current) {
        case Screen::Overview:
            render_overview(display, state);
            break;
        case Screen::Details:
            render_details(display, state);
            break;
        case Screen::Settings:
            render_settings(display, state);
            break;
    }

    display-&gt;refresh();
}

// Main loop
Screen current_screen = Screen::Overview;
const auto flip_interval = std::chrono::seconds(10);
auto last_flip = std::chrono::steady_clock::now();

while (running) {
    auto now = std::chrono::steady_clock::now();
    if (now - last_flip &gt;= flip_interval) {
        // Rotate to next screen
        current_screen = static_cast&lt;Screen&gt;((static_cast&lt;int&gt;(current_screen) + 1) % 3);
        render_current_screen(display, current_screen, state);
        last_flip = now;
    }

    std::this_thread::sleep_for(std::chrono::milliseconds(100));
}
@endicode 

@subsection autotoc_md64 Pattern: Periodic Updates

See the &lt;a href="../examples/crypto_dashboard/" &gt;crypto dashboard example&lt;/a&gt; for a complete real-world implementation.

@section autotoc_md65 Debugging &amp; Troubleshooting

@subsection autotoc_md66 BMP Export for Debugging

&lt;strong&gt;NEW:&lt;/strong&gt; Save your framebuffer to a BMP file for instant visual inspection without waiting for slow display refresh!

@icode{cpp} 
// Draw your content
display-&gt;clear(Color::White);
display-&gt;draw(
    display-&gt;text("Layout Test")
        .at(10, 10)
        .font(&amp;Font::font16())
        .foreground(Color::Black)
        .background(Color::White)
        .build()
);
display-&gt;draw(
    display-&gt;rectangle()
        .top_left(5, 5)
        .bottom_right(250, 170)
        .color(Color::Black)
        .fill(DrawFill::Empty)
        .build()
);

// Save to BMP for debugging (instant!)
auto result = display-&gt;save_framebuffer_to_bmp("debug_layout.bmp");
if (!result) {
    std::cerr &lt;&lt; "BMP export failed: " &lt;&lt; result.error().what() &lt;&lt; "<br  />
";
}

// Now refresh to display (slow, ~2 seconds)
display-&gt;refresh();
@endicode 

&lt;strong&gt;Benefits:&lt;/strong&gt;
- &lt;strong&gt;Instant feedback&lt;/strong&gt;: See your layout immediately without 2-second display refresh
- &lt;strong&gt;Works anywhere&lt;/strong&gt;: View BMP on your computer, no display hardware needed
- &lt;strong&gt;Perfect accuracy&lt;/strong&gt;: Shows exactly what will appear on display (with orientation)
- &lt;strong&gt;Iterative development&lt;/strong&gt;: Quickly test different layouts

&lt;strong&gt;Color mapping:&lt;/strong&gt;
- &lt;strong&gt;BlackWhite mode&lt;/strong&gt;: Black→RGB(0,0,0), White→RGB(255,255,255)
- &lt;strong&gt;Grayscale4 mode&lt;/strong&gt;: Black→RGB(0,0,0), Gray2→RGB(85,85,85), Gray1→RGB(170,170,170), White→RGB(255,255,255)

&lt;strong&gt;Example workflow:&lt;/strong&gt;
@icode{cpp} 
// Rapid layout iteration without hardware
for (int layout = 0; layout &lt; 5; ++layout) {
    display-&gt;clear(Color::White);
    render_layout(display, layout);

    // Save each layout variant
    display-&gt;save_framebuffer_to_bmp("layout_" + std::to_string(layout) + ".bmp");
}

// Review all BMPs on computer, pick best one
// Then deploy to hardware
display-&gt;clear(Color::White);
render_layout(display, best_layout);
display-&gt;refresh();  // Only one slow refresh needed!
@endicode 

See &lt;tt&gt;examples/bmp_debug_example.cpp&lt;/tt&gt; for a complete demonstration.

@subsection autotoc_md67 Display Not Responding

&lt;strong&gt;Symptoms:&lt;/strong&gt; No output on display, or refresh hangs indefinitely.

&lt;strong&gt;Solutions:&lt;/strong&gt;
1. Check hardware connections (especially BUSY pin)
2. Verify SPI is enabled: &lt;tt&gt;sudo raspi-config&lt;/tt&gt; → Interface Options → SPI
3. Ensure user is in &lt;tt&gt;gpio&lt;/tt&gt; and &lt;tt&gt;spi&lt;/tt&gt; groups: &lt;tt&gt;groups&lt;/tt&gt; (should show both)
4. If not in groups, add with: &lt;tt&gt;sudo usermod -a -G gpio,spi \$USER&lt;/tt&gt; (then log out/in)
4. Check display power supply (3.3V, sufficient current)

@subsection autotoc_md68 Garbled Output

&lt;strong&gt;Symptoms:&lt;/strong&gt; Random pixels, incorrect rendering.

&lt;strong&gt;Solutions:&lt;/strong&gt;
1. Check SPI wiring (MOSI, SCLK must be correct)
2. Verify ground connection
3. Ensure display mode matches drawing colors
4. Check framebuffer isn't corrupted (clear before drawing)

@subsection autotoc_md69 Slow Performance

&lt;strong&gt;Symptoms:&lt;/strong&gt; Long delays, sluggish updates.

&lt;strong&gt;Solutions:&lt;/strong&gt;
1. Batch drawing operations (single &lt;tt&gt;refresh()&lt;/tt&gt; at end)
2. Reduce refresh frequency (e.g., 5-10 second intervals)
3. Profile code to find bottlenecks
4. Remember: e-paper refresh is inherently slow (~2s for EPD27)

@subsection autotoc_md70 Memory Issues

&lt;strong&gt;Symptoms:&lt;/strong&gt; Out of memory errors, crashes on Raspberry Pi Zero.

&lt;strong&gt;Solutions:&lt;/strong&gt;
1. Use BlackWhite mode instead of Grayscale4 (half memory)
2. Don't load large images unnecessarily
3. Clear framebuffer when switching contexts
4. Consider using Raspberry Pi 3/4 (more RAM)

@subsection autotoc_md71 Colors Not Displaying

&lt;strong&gt;Symptoms:&lt;/strong&gt; Gray colors appear as black.

&lt;strong&gt;Solutions:&lt;/strong&gt;
1. Verify using &lt;tt&gt;Grayscale4&lt;/tt&gt; mode (not &lt;tt&gt;BlackWhite&lt;/tt&gt;)
2. Check display supports grayscale (EPD27 does)
3. Ensure using &lt;tt&gt;Color::Gray1&lt;/tt&gt; or &lt;tt&gt;Color::Gray2&lt;/tt&gt; (not just &lt;tt&gt;Black&lt;/tt&gt;/&lt;tt&gt;White&lt;/tt&gt;)

&lt;hr&gt;

&lt;strong&gt;For architecture details, see @ref "/mnt/nas/libepaper/docs/ARCHITECTURE.md" "<a class="el" href="../../da/d01/ARCHITECTURE_8md.html">ARCHITECTURE.md</a>".&lt;/strong&gt;
&lt;strong&gt;For driver development, see @ref "/mnt/nas/libepaper/docs/DRIVER.md" "<a class="el" href="../../de/d79/DRIVER_8md.html">DRIVER.md</a>".&lt;/strong&gt;
&lt;strong&gt;For examples, see @ref "/mnt/nas/libepaper/examples/README.md" "examples/README.md". </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
